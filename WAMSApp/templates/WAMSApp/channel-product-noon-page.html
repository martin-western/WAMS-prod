{% extends 'WAMSApp/base.html' %}

{% block content %}

{% load static %}

<link rel = 'stylesheet' type="text/css" href="{% static 'WAMSApp/css/materialize_override.css' %}"/>
<script src="https://cdn.ckeditor.com/ckeditor5/11.0.1/decoupled-document/ckeditor.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'WAMSApp/css/document_editor.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'WAMSApp/css/main.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'WAMSApp/css/dropdown.css' %}">

<div>
    <div class="row main-div" style="margin: 0px 70px 0px 0px; padding: 20px 10px !important;" >
        

        <div class="col s4 image-section" style="height: 90vh;">
            <div class="main-image" style="position: relative;">
                <a id="download-image-btn" href="#!" class="right btn-floating btn-small white"
                    style="position:absolute;right:0.5em;top:0.5em;z-index: 100;"><i class="material-icons"
                        style="color: #521893;">file_download</i></a>
            </div>

            <div class="image-section-dropdown">
                <div class="input-field image-section-dropdownchild">
                    <select id="images-category">
                        <option value="All Images" id="all-images-option">All Images</option>
                        <option value="Main Images" id="main-images-option">Main Images</option>
                        <option value="Sub Images" id="sub-images-option">Sub Images</option>
                        <!-- <option value="PFL Images" id="pfl-images-option">PFL Images</option>
                        <option value="PFL Generated Images" id="pfl-generated-images-option">PFL Generated Images
                        </option>
                        <option value="White Background Images" id="white-background-images-option">White Background
                            Images</option>
                        <option value="Lifestyle Images" id="lifestyle-images-option">Lifestyle Images</option>
                        <option value="Certificate Images" id="certificate-images-option">Certificate Images</option>
                        <option value="Giftbox Images" id="giftbox-images-option">Giftbox Images</option>
                        <option value="Diecut Images" id="diecut-images-option">Diecut Images</option>
                        <option value="A+ Content Images" id="aplus-content-images-option">A+ Content Images</option>
                        <option value="Ads Images" id="ads-images-option">Ads Images</option>
                        <option value="Unedited Images" id="unedited-images-option">Unedited Images</option> -->
                    </select>
                </div>

                <div class="image-section-dropdownchild sidebtn">
                    <a href="#upload-image-modal" id="import-btn" class="modal-trigger">
                        <i class="material-icons" title="Add Image" style="
              color: gray;
              background-color: white;
              padding: 8px;
                ">
                            add_photo_alternate
                        </i>
                    </a>
                </div>
            </div>

            <div class="row" style="position: relative;bottom: 15px;right: 5px;">
                <div id="graphics-section" class="col s12" style="width: 94%;padding-top: 1.11em;">

                </div>
            </div>
        </div>

        <div id="collapse-div" class="col s8 center collapse-div-container"
            style="transition: width 0.5s;">

            <div class="collapse-div" style = "padding-right:0px !important;overflow-x:hidden  !important;">
                <div class="scroll-style-1 ">
                    <h6 style="color: #521893;margin: 30px 0px 30px 0px !important;">Noon</h6>
                    <div class="row margin-zero collapse-div-row-container">
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="product-name" type="text">
                            <label for="product-name">Product Name</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input disabled placeholder="" id="product-id" type="text">
                            <label for="product-id">Product ID</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-product-type" type="text">
                            <label for="noon-product-type">Product Type</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-product-subtype" type="text">
                            <label for="noon-product-subtype">Product Subtype</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-model-number" type="text">
                            <label for="noon-model-number">Model Number</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-model-name" type="text">
                            <label for="noon-model-name">Model Name</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-msrp-ae" type="number">
                            <label for="noon-msrp-ae">MSRP AE</label>
                        </div>

                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="noon-msrp-ae-unit" type="text">
                            <label for="noon-msrp-ae-unit">MSRP AE Unit</label>
                        </div>
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="product-description" type="text">
                            <label for="product-description">Description</label>
                        </div>


                        <div class = "col s12" style="padding-left: 0px !important;">
                            <div class="input-field col s10">
                                <input placeholder="" id="product-attribute-noon-1" type="text">
                                <label for="product-attribute-noon-1">Product Attribute</label>
                            </div>

                            <div class="input-field col s2">
                                <a id="add-product-attribute-noon-btn" href="#!" class="btn-floating blue"
                                    style="background-color: #512ea8 !important; transform: scale(0.7);box-shadow: none;"><i
                                        class="material-icons">add</i></a>
                            </div>
                        </div>  
                        <div class="col s12" id = "product-attributes-noon-div" style="padding-left: 0px !important;"></div>

                      
                        <div class="input-field col s6 toggle-s6-s12">
                            <input placeholder="" id="created-date" type="date">
                            <label for="created-date">Created Date</label>
                        </div>


                        <!-- <div class="col s12">
                            <h6 class="grey-text left-align" style="padding-left: 50px;font-size: 1rem;">Product
                                Description</h6>
                            <div class="input-field" style="text-align: left;">
                                <div class="document-editor">
                                    <div class="document-editor__toolbar"></div>
                                    <div class="document-editor__editable-container">
                                        <div class="document-editor__editable">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>

            </div>
        </div>

        <div id="sidebar2" class="col s4" style="background-color: white;display: none;">
            <div class="row">
                <div class="input-field col s12" style="margin-top: 30px !important;">
                    <select  id="reference-channel">
                        <option value = "" selected>Select Channel</option>
                        <option order = "1" value="">Amazon UK</option>
                        <option order = "2" value="">Uae</option>
                        <option order = "3" value="">Ebay</option>
                    </select>
                    <label>Channels</label>
                </div>
                <div class = "toggle_btw_forms">
                    <div id = "toggle_btw_forms1" style = "display: none;">
                        <div class="input-field col s12 m6">
                            <input placeholder="" disabled id="uk-sidenav-product-name" type="text">
                            <label for="uk-sidenav-product-name">Product Name</label>
                        </div>
                        <div class="input-field col s12 m6">
                            <input placeholder="" disabled id="uk-sidenav-feed-product-type" type="text">
                            <label for="uk-sidenav-feed-product-type">Product Type</label>
                        </div>
                        <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="uk-sidenav-update-delete" type="text">
                          <label for="uk-sidenav-update-delete">Update Delete</label>
                        </div>
                        <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="uk-sidenav-variation-theme" type="text">
                          <label for="uk-sidenav-variation-theme">Variation Theme</label>
                        </div>
                    </div>
          
                    <div id = "toggle_btw_forms2" style = "display: none;">
                        <div class="input-field col s12 m6">
                            <input placeholder="" disabled id="uae-sidenav-product-name" type="text">
                            <label for="uae-sidenav-product-name">Product Name</label>
                        </div>
                        <div class="input-field col s12 m6">
                            <input placeholder="" disabled id="uae-sidenav-feed-product-type" type="text">
                            <label for="uae-sidenav-feed-product-type">Product Type</label>
                        </div>
                        <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="uae-sidenav-update-delete" type="text">
                          <label for="uae-sidenav-update-delete">Update Delete</label>
                        </div>
                        <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="uae-sidenav-recommended-browse-nodes" type="text">
                          <label for="uae-sidenav-recommended-browse-nodes">Recommended Browse Nodes</label>
                        </div>
                    </div>
          
                
                    <div id = "toggle_btw_forms3" style="display: none;">
                        <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="ebay-sidenav-product-name" type="text">
                          <label for="ebay-sidenav-product-name">Product Name</label>
                      </div>
                      <div class="input-field col s12 m6">
                          <input placeholder="" disabled id="ebay-sidenav-description" type="text">
                          <label for="ebay-sidenav-description">Description</label>
                      </div>
                      <div class="input-field col s12 m6">
                        <input placeholder="" disabled id="ebay-sidenav-category" type="text">
                        <label for="ebay-sidenav-category">Category</label>
                      </div>
                   </div>
                </div>


            </div>
        </div>
    </div>
</div>



<div id="upload-image-modal" class="modal">
    <div class="modal-content">
        <h4 style="font-family:'AvenirNext';font-size:18px;">Upload Image</h4>
        <div class="file-field input-field">
            <div class="btn" style="background-color: #512da8">
                <span style="font-size:14px;">File</span>
                <input id="product-image-input" type="file" multiple>
            </div>
            <div class="file-path-wrapper">
                <input class="file-path validate" type="text">
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
        <a id="upload-image-btn" href="#!" class="waves-effect waves-green btn-flat blue white-text"
            style="background-color:#009051 !important ;">Upload</a>
        <div class="progress" id="upload-preloader"
            style="display:none;margin: 0px !important;background-color: white !important;">
            <div class="indeterminate" style="background-color: #512de8;"></div>
        </div>
    </div>
</div>


<div id="delete-image-modal" class="modal">
    <div class="modal-content">
        <h4 style="font-family:'AvenirNext';font-size:18px;">Are you sure you want to delete the image?</h4>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
        <a id="delete-image-btn" href="#!" class="red waves-effect waves-red btn-flat white-text">Delete</a>
    </div>
</div>




<div class="toolbar"
    style="position: fixed; top: 0px; right: 0px;padding:20px 5px 20px 5px; height: 100vh; background-color: white;">
    <a class="right" href="#!" onclick="window.close()"
        style="background-color: transparent;display: block;cursor: pointer;">
        <i class="material-icons redd" title="Close" style="
      background-color: #f7f7f7;
      padding: 8px;
      color: gray;
      border-radius: 5px;
      margin-left: 8px;
      font-size: 20px;
      margin-right: 9px;
      display: block;
      margin-bottom: 10px;">
            close
        </i>
    </a>
    </br>

    <a class="right" href="/products" style="background-color: transparent;display: block;cursor: pointer;">
        <i class="material-icons homee" title="Products" style="
      background-color: #f7f7f7;
      padding: 8px;
      color: gray;
      border-radius: 5px;
      margin-left: 8px;
      font-size: 20px;
      margin-right: 9px;
      display: block;
      margin-bottom: 10px;">
            select_all
        </i>
    </a>

    </br>

     <a class="right button-collapse show-on-large" href="#" id="open-it-btn" style="background-color: transparent;display: block;cursor: pointer;" visible = "no">
        <i class="material-icons sidebare bluee" title="Products" style="
      background-color: #f7f7f7;
      padding: 8px;
      color: gray;
      border-radius: 5px;
      margin-left: 8px;
      font-size: 20px;
      margin-right: 9px;
      display: block;
      margin-bottom: 10px;">
            keyboard_arrow_left
        </i>
    </a>

    <div style="background-color: transparent; position: absolute;bottom: 15px;right: 4px;">
      

        <a href="#!" class=" right" style="background-color: transparent;display: block;">
            <i id="pending-icon" class="material-icons yelloww" title="Pending" style="
        background-color: #f7f7f7;
        padding: 8px;
        color: gray;
        border-radius: 5px;
        margin-left: 8px;
        font-size: 20px;
        margin-right: 9px;
        display: block;
        margin-bottom: 10px;">
                timer
            </i>
        </a>

        <a href="#!" class=" right" style="background-color: transparent;display: block;">
            <i id="verified-icon" class="material-icons greenn" title="Verified" style="
        background-color: #f7f7f7;
        padding: 8px;
        color: gray;
        border-radius: 5px;
        margin-left: 8px;
        font-size: 20px;
        margin-right: 9px;
        display: block;
        margin-bottom: 10px;">
                verified_user
            </i>
        </a>

        <a href="#!" id="main-image-select-save-btn" class="right"
            style="background-color: transparent;display: block;">
            <i class="material-icons bluee" title="Set Cover Image" style="
        background-color: #f7f7f7;
        padding: 8px;
        color: gray;
        border-radius: 5px;
        margin-left: 8px;
        font-size: 20px;
        margin-right: 9px;
        display: block;
        margin-bottom: 10px;">
                burst_mode
            </i>
        </a>

        <a href="#download-export-list-modal" class="modal-trigger right" style="background-color: transparent;">
            <i class="material-icons greenn" title="Export Product Details" style="
        background-color: #f7f7f7;
        padding: 8px;
        color: gray;
        border-radius: 5px;
        margin-left: 8px;
        font-size: 20px;
        margin-right: 9px;
        display: block;
        margin-bottom: 10px;">
                file_download
            </i>
        </a>

        {% if perms.WAMSApp.change_product %}
        <a href="#!" id="save-btn" class="right" style="background-color: transparent;">
            <i class="material-icons purplee" title="Save" style="
          background-color: #f7f7f7;
          padding: 8px;
          color: gray;
          border-radius: 5px;
          margin-left: 8px;
          font-size: 20px;
          margin-right: 9px;
          display: block;
          margin-bottom: 10px;">
                save
            </i>
        </a>
        {% endif %}
    </div>
</div>
       


<div id="download-export-list-modal" class="modal" style="border-radius: 5px;">
    <div class="modal-content">
        <h5 style="font-family: 'AvenirNext';font-size: 18px;">EXPORT PRODUCT</h5>
        <br>
        <div class="row">
            <div class="input-field col s6" style="padding-left: 0em !important;">
                <select id="export-format">
                    <option value="Amazon UK" selected>Amazon UK</option>
                    <option value="Amazon UAE">Amazon UAE</option>
                    <option value="Ebay">Ebay</option>
                    <option value="Noon">Noon</option>
                    <!-- <option value="Ebay" style="font-family: 'AvenirNextRegular';">Ebay</option>   -->
                </select>
                <label style="margin-left: 0em !important;">Export Format</label>
            </div>

            <div class="input-field col s6">
            </div>
        </div>
    </div>
    <div class="modal-footer" style="margin-bottom: 15px">
        <a href="#!" class="modal-close waves-effect btn-flat" style="margin-right: 20px;">Close</a>
        <a id="download-product-btn" href="#!" class="waves-effect btn-flat white-text"
            style="margin-right: 20px;background-color: #521893 !important;">Download</a>
    </div>
</div>


<div id="pfl-div" class="row white"
    style="text-align: center;margin-left: auto;display:none;height: 297mm;width: 210mm;">
    <!-- Brand Image Preview -->
    <div id="brand-image" class="col s6 right">
        <br>
        <img id="brand-image-img" src="" style="width: 73.5mm;margin-left:-27mm;display: none;position: absolute;">
    </div>

    <!-- Product Image Preview -->
    <div class="col s12" style="text-align: center; position: absolute;width: 210mm;margin-top: 40mm;">
        <img id="pfl-product-image-preview-img"
            style="max-width: 90%;max-height: 130mm;object-fit: scale-down;display: none;background-size: 100% 100%;">
        <br>
    </div>

    <!-- Product Name Preview -->
    <div class="col s12"
        style="background-color:#521893;text-align: center;width: 210mm;padding-bottom: 1em;position: absolute;margin-top: 190mm;width:210mm;height: 20mm;">
        <div id="product-name-preview" class="white-text left"
            style="padding-left: 1em;text-transform: uppercase;margin-top: 6.4mm;font-size: 1.7em;font-family:'AvenirNextRegular';">
        </div>
    </div>

    <!-- Seller SKU Preview -->
    <div class="col s12"
        style="background-color:white;position: absolute;margin-top: 192.5mm;width:45mm;height: 15mm;margin-left: 156mm;text-align: center;">
        <span id="seller-sku-preview"
            style="font-size: 1.4em;font-family:'AvenirNextRegular'; line-height: 16mm;color:#521893;"></span>
    </div>

    <!-- Features Preview -->
    <div class="col s12" style="position: absolute;margin-top: 218mm;width: 10mm;">
        <span style="color:#521893;font-size: 1.4em;font-family: 'AvenirNext';padding-left: 1em;">Features</span>
    </div>
    <div class="col s12" style="margin-top: 215mm;">
        <div id="features-preview-div" style="text-align: left; padding-left: 1.3em;">
        </div>
    </div>


    <!-- Barcode Preview -->
    <div class="col s3" style="position: absolute;margin-top: 240mm;width:45mm;margin-left:152mm;">
        <br><br>
        <img id="barcode-image-preview-img" src="" style="display:none;width: 100%;">
    </div>

    <!-- Footer -->
    <div class="col s12"
        style="background-color:#521893;position: absolute;margin-top: 287mm;width:210mm;height: 10mm;">
        <div class="white-text" style="font-size: 1.1em;margin-top:-1mm;">
            <p class="right" style="color:#009051;font-size: 0.8em;color:white;font-family:'AvenirNextRegular';">For
                more
                information, please visit www.royalford.com</p>
        </div>
    </div>

</div>


<ul id="slide-out" class="sidenav">
    <li><a href="#!"><i class="material-icons">cloud</i>First Link With Icon</a></li>
    <li><a href="#!">Second Link</a></li>
    <li>
        <div class="divider"></div>
    </li>
    <li><a class="subheader">Subheader</a></li>
    <li><a class="waves-effect" href="#!">Third Link With Waves</a></li>
</ul>


<script type="text/javascript" src="{% static 'WAMSApp/js/html2canvas.js' %}"></script>
<script type="text/javascript" src="{% static 'WAMSApp/js/canvas2image.js' %}"></script>
<script type="text/javascript">



    $('.tabs').tabs();
    $('.chips').chips();
    $('select').formSelect();
    $('.modal').modal();
    $('body').css('background-color', '#ebebeb');
    $('.sidenav').sidenav({ edge: 'left' });


    var global_details_noon = {};


    function fill_sidebar_uk(){
        var data = global_details_amazon_uk;
        $('#uk-sidenav-product-name').val(data["product_name"]);
        $('#uk-sidenav-feed-product-type').val(data["feed_product_type"]);
        $('#uk-sidenav-update-delete').val(data["update_delete"]);
        $('#uk-sidenav-variation-theme').val(data["variation_theme"]);
    }



    function fetch_details_amazon_uk()
  {
    console.log("Here");
    $.ajax({
      url: "/fetch-channel-product-amazon-uk/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
           global_details_amazon_uk = response["amazon_uk_product_json"];
           console.log("uk_data" , global_details_amazon_uk);
           fill_sidebar_uk();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }

        console.log("heye");
        console.log(global_details_amazon_uk);
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  fetch_details_amazon_uk();


  function fill_side_form_ebay()
  {
    var data = global_details_ebay;
    $('#ebay-sidenav-product-name').val(data["product_name"]);
    $('#ebay-sidenav-description').val(data["product_description"]);
    $('#ebay-sidenav-category').val(data[""]);
  }

  function fetch_details_ebay()
  {
    $.ajax({
      url: "/fetch-channel-product-ebay/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_details_ebay = response["ebay_product_json"];
          
          fill_side_form_ebay();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  fetch_details_ebay();


  function fill_side_form_uae(){
    var data = global_details_amazon_uae;
    $('#uae-sidenav-product-name').val(data["product_name"]);
    $('#uae-sidenav-recommended-browse-nodes').val(data["recommended_browse_nodes"]);
    $('#uae-sidenav-update-delete').val(data["update_delete"]);
    $('#uae-sidenav-feed-product-type').val(data["feed_product_type"]);
  }

  function fetch_details_amazon_uae()
  {
    $.ajax({
      url: "/fetch-channel-product-amazon-uae/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_details_amazon_uae = response["amazon_uae_product_json"];
          // render_amazon_uk();
          fill_side_form_uae();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
        console.log("uae");
        console.log(global_details_amazon_uae);
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  fetch_details_amazon_uae();


    $("#open-it-btn").click(function () {


        if ($(this).attr("visible") == "no") {
                    $( ".toggle-s6-s12" ).each(function( index ) {
                  $(this).addClass("s12");
          });
            $(this).attr("visible", "yes");
            $("#collapse-div").attr("class", "col s4 center");
            $("#sidebar2").show(600);
            console.log($(this));
            $(this).children().text("keyboard_arrow_right");
            // $(".main-div").css('margin-right' , '0px');
        }
        else {
            $(this).attr("visible", "no");
            $( ".toggle-s6-s12" ).each(function( index ) {
                    $(this).removeClass("s12");
            });
            $("#sidebar2").hide();
            $("#collapse-div").attr("class", "col s8 center");
            $(".main-div").css('margin-right' , '70px');
            $(this).children().text("keyboard_arrow_left");
        }
    })

    // $('.button-collapse').sidenav({
    //   menuWidth: 300, // Default is 240
    //   edge: 'right', // Choose the horizontal origin
    //   closeOnClick: true,
    //   isFixed: true,
    //   // Closes side-nav on <a> clicks, useful for Angular/Meteor
    // }
    // );




    $(document).on('change','#reference-channel',function(){
      console.log("clicked");
      $('#reference-channel option').each(function() {
        if ($(this).is(':selected')) {
          var order = $(this).attr("order");
          $("#toggle_btw_forms"+order).css("display","block");
        }
        else{
          var order = $(this).attr("order");
          $("#toggle_btw_forms"+order).css("display","none");
        }
    });
  });



    var global_verification_status = false;
    var global_delete_image_pk = null;

    //Page reload prevent logic
    let savecounter = false;
    $('#save-btn').click(() => {
        savecounter = false;
    })

    $('input').click(function () {
        savecounter = true;
    })

    function preventDefault() {
        if (savecounter) {
            alert('Please save the details before refreshing!');
        }
        else {
            window.close();
        }
    }

    $('#close-btn').click(function () {
        preventDefault();
    })


    $("#download-product-btn").click(function () {

        var export_format = $("#export-format").val();

        $.ajax({
            url: "/download-product/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            data: {
                product_pk: window.location.pathname.split("/")[3],
                export_format: export_format
            },
            success: function (response) {
                console.log("Success!", response);
                $("#download-export-list-modal").modal("close");
                var file_path = response["file_path"]
                window.open(file_path);
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });

    });

    window.addEventListener('beforeunload', function (e) {
        if (savecounter) {
            e.preventDefault();
            e.returnValue = '';
        }
        else
            window.close();
    });

    $("#pending-icon").click(function () {
        if (global_verification_status) {
            call_verify_api(0);
        }
    });

    $("#verified-icon").click(function () {
        if (!global_verification_status) {
            call_verify_api(1);
        }
    });

    function call_verify_api(verify) {
        var fd = new FormData()
        fd.append("product_pk", window.location.pathname.split("/")[3]);
        fd.append("verify", verify);

        $.ajax({
            url: "/verify-product/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            processData: false,
            contentType: false,
            data: fd,
            success: function (response) {
                console.log("Success!", response);
                if (response["status"] == 200) {
                    if (verify == 1) {
                        set_verify(true);
                        global_verification_status = true;
                        M.toast({ html: "Product status changed to verified" });
                    }
                    else {
                        set_verify(false);
                        global_verification_status = false;
                        M.toast({ html: "Product status changed to pending" });
                    }
                }
                else if (response["status"] == 403) {
                    M.toast({ html: "You do not have access to update the status!" });
                }
                else {
                    M.toast({ html: "Error updating the status!" });
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    }

    $(document).ready(function () {
        $('.tabs').tabs();
    });

    $('#barcode-string').characterCounter();

    $("#download-image-btn").click(function () {

        $("#download-image-btn").attr("disabled", "disabled");
        var high_def_url = $($(".preview-img")[0]).attr("high_def_url");
        var image_links = [];
        image_links.push({
            "key": "high_def_url",
            "url": high_def_url
        })

        $.ajax({
            url: "/download-images-s3/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            data: {
                links: JSON.stringify(image_links)
            },
            success: function (response) {
                console.log("Success! ", response);
                $("#download-image-btn").removeAttr("disabled");
                if (response["status"] == 200) {
                    var local_link = response["local_links"][0]["url"];

                    var a = document.createElement('a');
                    a.href = local_link;
                    var filename = high_def_url.split("/")[high_def_url.split("/").length - 1];
                    a.download = filename;
                    a.click();
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
                $("#download-image-btn").removeAttr("disabled");
            }
        });
    });

    var pfl_feature_cnt = 2;

    $("#add-feature-btn").click(function () {
        var html_string = `<div class="feature-div">
                         <div class="input-field col s9">
                           <input class="feature-text" id="pfl-feature-`+ pfl_feature_cnt + `" type="text" >
                           <label for="pfl-feature-`+ pfl_feature_cnt + `">Feature</label>
                         </div>

                        <div class="input-field col s1">
                          <a href="#!" class="delete-feature-btn btn-floating red" style="transform: scale(0.7);box-shadow: none;"><i class="material-icons">remove</i></a>
                        </div>
                      </div>`;
        $("#feature-summary-editor-div").append(html_string);
        pfl_feature_cnt++;
    });


    $(document).on('click', ".delete-feature-btn", function () {
        $(this).parent().parent().remove();
    });

    // $('.pflspecific').hide(); 

    $("#heading-title").html("PRODUCT FORM");

    window.editor = []

    DecoupledEditor
        .create(document.querySelector('.document-editor__editable'), {
            cloudServices: {
            }
        })
        .then(editor => {
            const toolbarContainer = document.querySelector('.document-editor__toolbar');

            toolbarContainer.appendChild(editor.ui.view.toolbar.element);
            //editor.isReadOnly = !response['edit_access'];
            window.editor.push(editor);
        })
        .catch(err => {
            console.error(err);
        });

    DecoupledEditor
        .create(document.querySelector('.clone2_editable'), {
            cloudServices: {
            }
        })
        .then(editor => {
            const toolbarContainer = document.querySelector('.clone2_toolbar');

            toolbarContainer.appendChild(editor.ui.view.toolbar.element);
            //editor.isReadOnly = !response['edit_access'];
            window.editor.push(editor);
        })
        .catch(err => {
            console.error(err);
        });

    DecoupledEditor
        .create(document.querySelector('.clone3_editable'), {
            cloudServices: {
            }
        })
        .then(editor => {
            const toolbarContainer = document.querySelector('.clone3_toolbar');

            toolbarContainer.appendChild(editor.ui.view.toolbar.element);
            //editor.isReadOnly = !response['edit_access'];
            window.editor.push(editor);
        })
        .catch(err => {
            console.error(err);
        });




    DecoupledEditor
        .create(document.querySelector('.clone4_editable'), {
            cloudServices: {
            }
        })
        .then(editor => {
            const toolbarContainer = document.querySelector('.clone4_toolbar');

            toolbarContainer.appendChild(editor.ui.view.toolbar.element);
            //editor.isReadOnly = !response['edit_access'];
            window.editor.push(editor);
        })
        .catch(err => {
            console.error(err);
        });



    function getCsrfToken() {
        var CSRF_TOKEN = $('input[name="csrfmiddlewaretoken"]').val();
        return CSRF_TOKEN;
    }

    var global_images = {};
    var global_image_key = "all_images";

    function fetch_constant_values() {
        $.ajax({
            url: "/fetch-constant-values/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            data: {},
            success: function (response) {
                console.log("Success!", response);
                if (response["status"] == 200) {
                    var autocomplete_data = {}
                    var material_list = response["material_list"];
                    for (var i = 0; i < material_list.length; i++) {
                        autocomplete_data[material_list[i]["name"]] = null;
                    }
                    $('#material-type').autocomplete({
                        data: autocomplete_data
                    });

                    autocomplete_data = {};
                    var ebay_category_list = response["ebay_category_list"];
                    for (var i = 0; i < ebay_category_list.length; i++) {
                        autocomplete_data[ebay_category_list[i]["name"] + "|" + ebay_category_list[i]["category_id"]] = null;
                    }
                    $('#category').autocomplete({
                        data: autocomplete_data,
                        onAutocomplete: function (val) {
                            var category_id = val.split("|")
                            category_id = category_id[category_id.length - 1];
                            $("#category").val(category_id);
                        }
                    });


                    autocomplete_data = {};
                    var brand_list = response["brand_list"];
                    for (var i = 0; i < brand_list.length; i++) {
                        autocomplete_data[brand_list[i]["name"]] = null;
                    }
                    $('#brand-name').autocomplete({
                        data: autocomplete_data
                    });


                    var product_id_type_list = response["product_id_type_list"];
                    var html_string = `<option value="" selected>Product ID Type</option>`;
                    for (var i = 0; i < product_id_type_list.length; i++) {
                        html_string += `<option value="` + product_id_type_list[i]["name"] + `">` + product_id_type_list[i]["name"] + `</option>`
                    }




                    $("#product-id-type").html(html_string);
                    $('select').formSelect();
                }
                else {
                    //M.toast({html:"Duplicate product detected!"});
                }
                //$("#save-btn").removeAttr("disabled");
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    }

    fetch_constant_values();

    function fetch_noon_product_images_details() {

$.ajax({
url: "/fetch-channel-product-noon/",
type: "POST",
headers: {
    'X-CSRFToken': getCsrfToken()
},
data: {
    product_pk: window.location.pathname.split("/")[3]
},
success: function (response) {
    console.log("Success!", response);

    if (response["status"] == 200) {
    $('.material-placeholder').remove();
    $('.main-image').append(`<img class = "preview-img materialboxed" src='` + response["repr_image_url"] + `' high_def_url="` + response["repr_high_def_url"] + `">`)
    $('.materialboxed').materialbox();

    global_images = response["images"];
    console.log("global_images ", global_images)

    $("#all-images-option").html("All Images (" + global_images["all_images"].length + ")");
    $("#main-images-option").html("Main Images (" + global_images["main_images"].length + ")");
    $("#sub-images-option").html("Sub Images (" + global_images["sub_images"].length + ")");
    
    // update_grid_images(global_image_key);

    M.updateTextFields();
    $('select').formSelect();
    }
    else {
    M.toast({ html: "Error fetching images information" });
    }
},
error: function (xhr, textstatus, errorthrown) {
    console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
}
});
}   

fetch_noon_product_images_details();

$("#upload-image-btn").click(function () {

$("#upload-image-btn").attr("disabled", "disabled");
$("#upload-preloader").show();

product_pk = window.location.pathname.split("/")[3];

var fd = new FormData();

fd.append("product_pk", product_pk);
var product_image_input = document.getElementById("product-image-input");

fd.append('image_count', product_image_input.files.length);
for (var i = 0; i < product_image_input.files.length; i++) {
fd.append('image_' + i, product_image_input.files[i]);
}


fd.append('image_category', global_image_key);
fd.append('channel_name', "Noon");
$.ajax({
url: "/upload-product-image/",
type: "POST",
headers: {
    'X-CSRFToken': getCsrfToken()
},
processData: false,
contentType: false,
data: fd,
success: function (response) {
    console.log("Success!", response);
    $("#upload-preloader").hide();
    $("#upload-image-btn").removeAttr("disabled");

    if (response["status"] == 200) {
        $("#upload-image-modal").modal("close");
        M.toast({ html: "Successfully uploaded images!" });
        fetch_noon_product_images_details();
    }
    else if (response["status"] == 403) {
        M.toast({ html: "You do not have permission to upload images!" });
    }
    else {
        M.toast({ html: "Error uploading images!" });
    }
},
error: function (xhr, textstatus, errorthrown) {
    console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
    $("#upload-preloader").hide();
}
});
})

    function set_verify(verified) {
        if (verified == true) {
            $("#pending-icon").css("background-color", "#f7f7f7");
            $("#pending-icon").css("color", "gray");
            $("#verified-icon").css("background-color", "#009051");
            $("#verified-icon").css("color", "white");
        }
        else {
            $("#verified-icon").css("background-color", "#f7f7f7");
            $("#verified-icon").css("color", "gray");
            $("#pending-icon").css("background-color", "orange");
            $("#pending-icon").css("color", "white");
        }
    }



    var product_attribute_amazon_uk_cnt = 1;
    $("#add-product-attribute-amazon-uk-btn").click(function () {
        product_attribute_amazon_uk_cnt++;

        var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-amazon-uk-`+ product_attribute_amazon_uk_cnt + `" type="text" >
                           <label for="product-attribute-amazon-uk-`+ product_attribute_amazon_uk_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-amazon-uk-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
        $("#product-attributes-amazon-uk-div").append(html_string);
    });

    $(document).on("click", ".remove-product-attribute-amazon-uk-btn", function () {
        $(this).parent().parent().remove();
    });


    var product_attribute_amazon_uae_cnt = 1;
    $("#add-product-attribute-amazon-uae-btn").click(function () {
        product_attribute_amazon_uae_cnt++;

        var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-amazon-uae-`+ product_attribute_amazon_uae_cnt + `" type="text" >
                           <label for="product-attribute-amazon-uae-`+ product_attribute_amazon_uae_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-amazon-uae-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                      </div>`
        $("#product-attributes-amazon-uae-div").append(html_string);
    });

    $(document).on("click", ".remove-product-attribute-amazon-uae-btn", function () {
        $(this).parent().parent().remove();
    });


    var product_attribute_ebay_cnt = 1;
    $("#add-product-attribute-ebay-btn").click(function () {
        product_attribute_ebay_cnt++;

        var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-ebay-`+ product_attribute_ebay_cnt + `" type="text" >
                           <label for="product-attribute-ebay-`+ product_attribute_ebay_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-ebay-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
        $("#product-attributes-ebay-div").append(html_string);
    });

    $(document).on("click", ".remove-product-attribute-ebay-btn", function () {
        $(this).parent().parent().remove();
    });




    var product_attribute_noon_cnt = 1;
    var val_to_fill = ""
    $("#add-product-attribute-noon-btn").click(function () {
        product_attribute_noon_cnt++;

        var html_string = `<div>
                         <div class="input-field col s10">
                           <input id="product-attribute-noon-`+ product_attribute_noon_cnt + `" type="text" >
                         
                         </div>
                         <div class="input-field col s2">
                           <a href="#!" class="remove-product-attribute-noon-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
        $("#product-attributes-noon-div").append(html_string);
        $('#product-attribute-noon-'+product_attribute_noon_cnt).val(val_to_fill);
        val_to_fill = ""
    });

    $(document).on("click", ".remove-product-attribute-noon-btn", function () {
        $(this).parent().parent().remove();
    });




    var special_feature_cnt = 1;
    $("#add-special-feature-btn").click(function () {
        special_feature_cnt++;

        var html_string = `<div>
                           <div class="input-field col s9">
                             <input id="special-feature-`+ special_feature_cnt + `" type="text" >
                             <label for="special-feature-`+ special_feature_cnt + `">Special Feature</label>
                           </div>

                           <div class="input-field col s1">
                             <a href="#!" class="remove-special-feature-btn btn-floating blue" style = "background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                           </div>
                        </div>`
        $("#special-features-div").append(html_string);
    });

    $(document).on("click", ".remove-special-feature-btn", function () {
        $(this).parent().parent().remove();
    });


    function update_grid_images_main_images(key) {
        var html_string = "";
        for (var i = 0; i < global_images[key].length; i++) {
            var checked = "";
            if (global_images[key][i]["is_main_image"] == true) {
                checked = "checked";
            }

            if (i % 3 == 0) {
                html_string += "<div class='flex-container-space-btw' style='margin-top:0em;margin-bottom:0em;padding-top:0em !important;padding-bottom:0em !important;width:25.5vw !important;'>";
            }

            html_string += `<div style=";position:relative;">
                        <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:2px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
                          <i class="material-icons redd" title="Delete Image" style="
                            background-color: transparent;
                            padding: 4px;
                            color: gray;
                            border-radius: 2px;
                            margin-left: 4px;
                            font-size: 10px;
                            margin-right: 4px;
                            display: block;
                            margin-bottom: 5px;">
                            close
                          </i>
                        </a>
                        <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `"  style="width: 100%;object-fit:contain;">
                        <label style="margin-left:0px !important;">
                          <input value="`+ global_images[key][i]["pk"] + `" name="group1" type="radio" ` + checked + ` />
                          <span class = "checkbox"></span>
                        </label>
                      </div>`;

            if (i % 3 == 2 || i == global_images[key].length - 1) {
                html_string += "</div>";
            }
        }

        $("#graphics-section").html(html_string);
    }


    $(document).on('click', '.miniimage', function () {
        let url = $(this).attr('midimage_url');
        let high_def_url = $(this).attr('high_def_url');
        $('.material-placeholder').remove();
        $('.main-image').append(`<img class = "preview-img materialboxed" src = '` + url + `' high_def_url="` + high_def_url + `">`)
        $('.materialboxed').materialbox();
    });

    $(document).on("click", ".delete-image-modal-btn", function () {
        global_delete_image_pk = this.id.split("-")[1];
    })

    $("#delete-image-btn").click(function () {
        delete_image();
    })

    function delete_image() {
        var image_type = "";
        if (global_image_key == "sub_images" || global_image_key == "main_images") {
            image_type = "main_sub";
        }
        else {
            image_type = "other";
        }

        var fd = new FormData();
        fd.append("image_pk", global_delete_image_pk);
        fd.append("image_type", image_type);

        $.ajax({
            url: "/delete-image/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            processData: false,
            contentType: false,
            data: fd,
            success: function (response) {
                console.log("Success!", response);
                if (response["status"] == 200) {
                    M.toast({ html: "Image successfully deleted!" });
                    $("#delete-image-modal").modal("close");
                    fetch_product_images_details();
                }
                else if (response["status"] == 403) {
                    M.toast({ html: "You do not have permission to delete images!" });
                }
                else {
                    M.toast({ html: "Error deleting image!" });
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    }

    $("#main-image-select-save-btn").click(function () {

        if (global_image_key != "main_images") {
            return;
        }

        var fd = new FormData();

        var checked_pk = $("input[name=group1]:checked").val();
        fd.append("checked_pk", checked_pk);
        fd.append("product_pk", window.location.pathname.split("/")[3]);

        $.ajax({
            url: "/update-main-image/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            processData: false,
            contentType: false,
            data: fd,
            success: function (response) {
                console.log("Success!", response);
                if (response["status"] == 200) {
                    M.toast({ html: "Main image updated successfully!" });
                }
                else if (response["status"] == 403) {
                    M.toast({ html: "You do not have permission to update main image!" });
                }
                else {
                    M.toast({ html: "Error updating main image!" });
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    });


    function update_grid_images_sub_images(key) {
        var html_string = "";
        for (var i = 0; i < global_images[key].length; i++) {
            var checked = "";
            if (global_images[key][i]["is_sub_image"] == true) {
                checked = "checked";
            }

            if (i % 3 == 0) {
                html_string += "<div class='flex-container-space-btw' style='margin-top:0em;margin-bottom:0em;padding-top:0em !important;padding-bottom:0em !important;width:25.5vw !important;'>";
            }

            var sub_image_index = global_images[key][i]["sub_image_index"];
            if (sub_image_index == 0)
                sub_image_index = "-"

            html_string += `<div class="" style="position:relative;">
                        <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:4px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
                          <i class="material-icons redd" title="Delete Image" style="
                            background-color: transparent;
                            padding: 4px;
                            color: gray;
                            border-radius: 2px;
                            margin-left: 4px;
                            font-size: 10px;
                            margin-right: 4px;
                            display: block;
                            margin-bottom: 5px;">
                            close
                          </i>
                        </a>
                        <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `" style="width: 100%;object-fit:contain;">
                        <input value="`+ sub_image_index + `" id="subcheck_` + global_images[key][i]["pk"] + `" type="text">
                      </div>`;

            if (i % 3 == 2 || i == global_images[key].length - 1) {
                html_string += "</div>";
            }
        }
        $("#graphics-section").html(html_string);
    }

    function save_subimages_index() {
        if (global_image_key != "sub_images") {
            return;
        }
        var fd = new FormData();

        var sub_image = [];
        var key = "sub_images";

        // Check for condition
        var unique_sub_index = [];
        for (var i = 0; i < global_images[key].length; i++) {
            var sub_image_index = $("#subcheck_" + global_images[key][i]["pk"]).val().trim();
            if (sub_image_index != "-" && sub_image_index != "") {
                sub_image_index = parseInt(sub_image_index);
                if (sub_image_index >= 1 && sub_image_index <= 8) {
                    console.log("Key: ", sub_image_index);
                    if (unique_sub_index.includes(sub_image_index)) {
                        M.toast({ html: "Sub Image indices must be unique" })
                        return;
                    }

                    unique_sub_index.push(sub_image_index);
                }
                else {
                    M.toast({ html: "Sub Image indices must be between 1 to 8" })
                    return;
                }
            }
        }


        for (var i = 0; i < global_images[key].length; i++) {
            var temp_dict = {};
            temp_dict["pk"] = global_images[key][i]["pk"];
            var sub_image_index = $("#subcheck_" + global_images[key][i]["pk"]).val();
            if (sub_image_index == "" || sub_image_index == "-")
                sub_image_index = "0"
            temp_dict["sub_image_index"] = sub_image_index;
            sub_image.push(temp_dict);
        }

        fd.append("sub_images", JSON.stringify(sub_image));
        fd.append("product_pk", window.location.pathname.split("/")[3]);

        $.ajax({
            url: "/update-sub-images/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            processData: false,
            contentType: false,
            data: fd,
            success: function (response) {
                console.log("Success!", response);
                if (response["status"] == 200) {
                    M.toast({ html: "Sub images updated successfully!" });
                }
                else if (response["status"] == 403) {
                    M.toast({ html: "You do not have permission to update sub images!" });
                }
                else {
                    M.toast({ html: "Error updating sub images!" });
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    }


    function update_grid_images(key) {
        // if (key == "all_images") {
        //     $("#import-btn").attr("class", "disabled");
        // }
        // else {
        //     $("#import-btn").attr("class", "modal-trigger");
        // }

        // if (key == "main_images") {
        //     update_grid_images_main_images(key);
        //     return;
        // }


        // if (key == "sub_images") {
        //     update_grid_images_sub_images(key);
        //     return;
        // }


        // var html_string = "";
        // for (var i = 0; i < global_images[key].length; i++) {
        //     html_string += `<div class="col s4" style="padding:1em;">
        //                 <div style="position:relative;">
        //                   <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:2px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
        //                     <i class="material-icons redd" title="Delete Image" style="
        //                       background-color: transparent;
        //                       padding: 4px;
        //                       color: gray;
        //                       border-radius: 2px;
        //                       margin-left: 4px;
        //                       font-size: 10px;
        //                       margin-right: 4px;
        //                       display: block;
        //                       margin-bottom: 5px;">
        //                       close
        //                     </i> 
        //                   </a> 
        //                   <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `" style="width: 100%;object-fit:contain;">
        //                 </div>
        //               </div>`;
        // }

        // $("#graphics-section").html(html_string);
    }



    $("#images-category").change(function () {
        if ($("#images-category").val() == "All Images") {
            update_grid_images("all_images");
            global_image_key = "all_images";
        }
        else if ($("#images-category").val() == "Main Images") {
            update_grid_images("main_images");
            global_image_key = "main_images";
        }
        else if ($("#images-category").val() == "Sub Images") {
            update_grid_images("sub_images");
            global_image_key = "sub_images";
        }
        else if ($("#images-category").val() == "PFL Images") {
            update_grid_images("pfl_images");
            global_image_key = "pfl_images";
        }
        else if ($("#images-category").val() == "PFL Generated Images") {
            update_grid_images("pfl_generated_images");
            global_image_key = "pfl_generated_images";
        }
        else if ($("#images-category").val() == "White Background Images") {
            update_grid_images("white_background_images");
            global_image_key = "white_background_images";
        }
        else if ($("#images-category").val() == "Lifestyle Images") {
            update_grid_images("lifestyle_images");
            global_image_key = "lifestyle_images";
        }
        else if ($("#images-category").val() == "Certificate Images") {
            update_grid_images("certificate_images");
            global_image_key = "certificate_images";
        }
        else if ($("#images-category").val() == "Giftbox Images") {
            update_grid_images("giftbox_images");
            global_image_key = "giftbox_images";
        }
        else if ($("#images-category").val() == "Diecut Images") {
            update_grid_images("diecut_images");
            global_image_key = "diecut_images";
        }
        else if ($("#images-category").val() == "A+ Content Images") {
            update_grid_images("aplus_content_images");
            global_image_key = "aplus_content_images";
        }
        else if ($("#images-category").val() == "Ads Images") {
            update_grid_images("ads_images");
            global_image_key = "ads_images";
        }
        else if ($("#images-category").val() == "Unedited Images") {
            update_grid_images("unedited_images");
            global_image_key = "unedited_images";
        }
    });


    function save_pfl_image_to_bucket() {
        var pfl_product_name = $("#pfl-product-name").val();

        var seller_sku = $("#seller-sku").val();

        var image_links = [];

        //Set the images
        if (global_images["main_images"].length > 0) {
            $("#pfl-product-image-preview-img").attr("src", global_images["main_images"][0]["main-url"]);
        }

        //$("#brand-image-img").attr("src", "");
        //$("#barcode-image-preview-img").attr("src", "");


        if ($("#pfl-product-image-preview-img").attr("src") != "") {
            image_links.push({
                "key": "product_image",
                "url": $("#pfl-product-image-preview-img").attr("src")
            });
        }

        if ($("#brand-image-img").attr("src") != "") {
            image_links.push({
                "key": "brand_image",
                "url": $("#brand-image-img").attr("src")
            });
        }

        if ($("#barcode-image-preview-img").attr("src") != "") {
            image_links.push({
                "key": "barcode_image",
                "url": $("#barcode-image-preview-img").attr("src")
            });
        }


        $("#seller-sku-preview").html(seller_sku);

        var html_string = `<br><br>`;
        var feature_text = $(".feature-text");
        for (var i = 0; i < feature_text.length; i++) {
            html_string += `<span style="font-family: 'AvenirNextRegular'"><span style="color:#521893;">&bullet;&nbsp;&nbsp;</span> ` + feature_text[i].value + `</span><br>`
        }
        $("#features-preview-div").html(html_string);

        $("#product-name-preview").text(pfl_product_name);


        $.ajax({
            url: "/download-images-s3/",
            type: "POST",
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            data: {
                links: JSON.stringify(image_links)
            },
            success: function (response) {
                console.log("Success! ", response);
                if (response["status"] == 200) {
                    var local_links = response["local_links"];

                    for (var i = 0; i < response["local_links"].length; i++) {
                        if (local_links[i]["key"] == "product_image") {
                            $("#pfl-product-image-preview-img").attr("src", local_links[i]["url"]);
                            $("#pfl-product-image-preview-img").show();
                        }
                        else if (local_links[i]["key"] == "brand_image") {
                            $("#brand-image-img").attr("src", local_links[i]["url"]);
                            $("#brand-image-img").show();
                        }
                        else if (local_links[i]["key"] == "barcode_image") {
                            $("#barcode-image-preview-img").attr("src", local_links[i]["url"]);
                            $("#barcode-image-preview-img").show();
                        }
                    }

                    $('#pfl-div').css("display", "block");

                    html2canvas($("#pfl-div"), {
                        logging: true,
                        dpi: 600,
                        scale: 3,
                        onrendered: function (canvas) {

                            $("#pfl-div").hide();
                            var image_data = canvas.toDataURL();

                            var fd = new FormData();
                            fd.append('image_data', image_data);
                            fd.append('product_pk', window.location.pathname.split("/")[3]);

                            $.ajax({
                                url: "/save-pfl-in-bucket/",
                                type: "POST",
                                headers: {
                                    'X-CSRFToken': getCsrfToken()
                                },
                                processData: false,
                                contentType: false,
                                data: fd,
                                success: function (response) {
                                    console.log("Success!", response);
                                    if (response["status"] == 200) {
                                        global_images["pfl_generated_images"] = [{
                                            "main-url": response["main-url"],
                                            "midimage-url": response["midimage-url"],
                                            "thumbnail-url": response["thumbnail-url"]
                                        }];
                                        if (global_image_key != "sub_images") {
                                            update_grid_images(global_image_key);
                                        }

                                        if (global_image_key == "pfl_generated_images") {
                                            $($(".miniimage")[0]).click();
                                        }
                                    }
                                },
                                error: function (xhr, textstatus, errorthrown) {
                                    console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
                                }
                            });
                        }
                    });
                }
            },
            error: function (xhr, textstatus, errorthrown) {
                console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
            }
        });
    }


                function fill_product_details(){
                    var data = global_details_noon;
                    $('#product-id').val(data["product-id"]);
                    $('#noon-model-name').val(data["model_name"]);
                    $('#noon-model-number').val(data["model_number"]);
                    $('#noon-msrp-ae').val(data["msrp_ae"]);
                    $('#noon-msrp-ae-unit').val(data["msrp_ae_unit"]);
                    $('#product-name').val(data["product_name"]);
                    $('#product-description').val(data["product_description"]);
                    $('#noon-product-subtype').val(data["product_subtype"]);
                    $('#noon-product-type').val(data["product_type"]);
                    var product_attributes_list = data["product_attributes"];
        
                    if(product_attributes_list.length>0)
                    {
                    $("#product-attribute-noon-1").val(product_attributes_list[0]);
                    }
                    for(var i=1;i<product_attributes_list.length;i++)
                    {
                        $("#add-product-attribute-noon-btn").click();
                        $("#product-attribute-noon-" + (i+1)).val(product_attributes_list[i]);
                    }

                }


                    function fetch_details_noon()
                {
                    $.ajax({
                    url: "/fetch-channel-product-noon/",
                    type: "POST",
                    headers: {
                        'X-CSRFToken': getCsrfToken()
                    },
                    data: {
                        product_pk: window.location.pathname.split("/")[3]
                    },
                    success: function (response) {
                        console.log("Noon Success!", response);
                        if(response["status"]==200)
                        {
                        global_details_noon = response["noon_product_json"];
                        global_details_noon["product-id"] = response["product_id"];
                        // render_amazon_uk();
                        console.log("noon");
                        console.log(global_details_noon);
                        fill_product_details();
                        }
                        else
                        {
                        M.toast({ html: "Internal Server" });
                        }
                        
                    },
                    error: function (xhr, textstatus, errorthrown) {
                        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
                    }
                    });
                }

                fetch_details_noon();


                function save_product_noon() {

                        $("#save-btn").attr("disabled", "disabled");

                        var product_pk = window.location.pathname.split("/")[3];

                        var product_name = $("#product-name").val();
                        var product_id = $('#product-id').val();
                        var description = $('#product-description').val();
                        var model_number = $('#noon-model-number').val();
                        var model_name = $('#noon-model-name').val();
                        var msrp_ae = $('#noon-msrp-ae').val();
                        var msrp_ae_unit = $('#noon-msrp-ae-unit').val();
                        var product_type = $('#noon-product-type').val();
                        var product_subtype = $('#noon-product-subtype').val();
                        var created_date = $("#created-date").val();
                        // var category = $('#product-category').val();

                        // var feed_product_type = $("#feed-product-type").val();
                        // var variation_theme = $("#variation-theme").val();
                        // var update_delete = $("#update-delete").val();
                        // var recommended_browse_nodes = $("#recommended-browse-nodes").val();
                        // var search_terms = $("#search-terms").val();
                        // var enclosure_material = $("#enclosure-material").val();
                        // var cover_material_type = $("#cover-material-type").val();
                        // var sale_price = $("#sale-price").val();
                        // var sale_from = $("#sale-from").val();
                        // var sale_end = $("#sale-end").val();

                        // var special_feature_data = [];
                        // for (var i = 1; i <= special_feature_cnt; i++) {
                        // if ($("#special-feature-" + i).val() != "") {
                        //     special_feature_data.push($("#special-feature-" + i).val());
                        // }
                        // }
                        // special_feature_data = JSON.stringify(special_feature_data);

                        // var wattage = $("#wattage").val();
                        // var wattage_metric = $("#wattage-metric").val();
                        // var parentage = $("#parentage").val();
                        // var parent_sku = $("#parent-sku").val();
                        // var relationship_type = $("#relationship-type").val();
                        // var item_count = $("#item-count").val();
                        // var item_count_metric = $("#item-count-metric").val();
                        // var item_condition_note = $("#item-condition-note").val();
                        // var max_order_quantity = $("#max-order-quantity").val();
                        // var number_of_items = $("#number-of-items").val();
                        // var condition_type = $("#condition-type").val();

                        var product_attribute_data_noon = [];
                        for (var i = 1; i <= product_attribute_noon_cnt; i++) {
                          if ($("#product-attribute-noon-" + i).val() != "" && $("#product-attribute-noon-" + i).val() != undefined) {
                            product_attribute_data_noon.push($("#product-attribute-noon-" + i).val());
                          }
                        }
                        // product_attribute_data_noon = JSON.stringify(product_attribute_data_noon);


                        // "product_name" : "",
                        // "product_type" : "",
                        // "product_subtype" : "",
                        // "model_number" : "",
                        // "model_name" : "",
                        // "msrp_ae" : "",
                        // "msrp_ae_unit" : "",
                        // "product_description" : "",
                        // "product_attribute_list" : [],
                        // "created_date" : ""   

                        noon_data_json = {}

                        // noon_data_json["feed_product_type"] = feed_product_type;
                        noon_data_json["product_name"] = product_name;
                        noon_data_json["product_description"] = description
                        noon_data_json["msrp_ae"] = msrp_ae
                        noon_data_json["msrp_ae_unit"] = msrp_ae_unit
                        noon_data_json["model_number"] = model_number
                        noon_data_json["model_name"] = model_name
                        noon_data_json["product_subtype"] = product_subtype
                        noon_data_json["created_date"] = created_date
                        noon_data_json["product_attributes"] = product_attribute_data_noon

                        // noon_data_json["category"] = category
                        // noon_data_json["variation_theme"]  = variation_theme;
                        // noon_data_json["update_delete"] = update_delete;
                        // noon_data_json["recommended_browse_nodes"] = recommended_browse_nodes;
                        // noon_data_json["search_terms"] = search_terms;
                        // noon_data_json["enclosure_material"] = enclosure_material;
                        // noon_data_json["cover_material_type"] = cover_material_type;
                        // noon_data_json["sale_price"] = sale_price;
                        // noon_data_json["sale_from"] = sale_from;
                        // noon_data_json["sale_end"] = sale_end;
                        // noon_data_json["special_features"] = special_feature_data;
                        // noon_data_json["wattage"] = wattage;
                        // noon_data_json["wattage_metric"] = wattage_metric;
                        // noon_data_json["parentage"] = parentage;
                        // noon_data_json["parent_sku"] = parent_sku;
                        // noon_data_json["relationship_type"] = relationship_type;
                        // noon_data_json["item_count"] = item_count;
                        // noon_data_json["item_count_metric"] = item_count_metric;
                        // noon_data_json["item_condition_note"] = item_condition_note;
                        // noon_data_json["max_order_quantity"] = max_order_quantity;
                        // noon_data_json["number_of_items"] = number_of_items;
                        // noon_data_json["condition_type"] = condition_type;

                        console.log(noon_data_json);
                        $.ajax({
                        url: "/save-channel-product-noon/",
                        type: "POST",
                        headers: {
                            'X-CSRFToken': getCsrfToken()
                        },
                        data: {
                            noon_product_json : JSON.stringify(noon_data_json),
                            product_pk : product_pk
                        },
                        success: function (response) {
                            console.log("Saved Success!", response);
                            if (response["status"] == 200) {
                            global_details_noon = noon_data_json;
                            console.log("noon data" , global_details_noon);
                            M.toast({ html: "Product saved successfully!" });
                            }
                            else if (response["status"] == 403) {
                            M.toast({ html: "You do not have permission for saving product!" });
                            }
                            else {
                            M.toast({ html: "Error saving product!" });
                            }
                            $("#save-btn").removeAttr("disabled");
                        },
                        error: function (xhr, textstatus, errorthrown) {
                            console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
                        }
                        });

            }


    $('document').ready(()=>{
            $('#save-btn').click(function(){
            console.log("heye");
            save_product_noon();
            });
        })

    $("#information-tab").click(function () {
        setTimeout(function () {
            $('.tabs').tabs('updateTabIndicator');
        }, 100);
    });


    $(window).keydown(function (event) {
        console.log(event.which, event.keyCode, event.ctrlKey);
        if (event.which == 83 && event.ctrlKey) {
            event.preventDefault();
            save_product();
            return false;
        }
    });
</script>

{% endblock %}