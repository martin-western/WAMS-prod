{% extends 'WAMSApp/base.html' %}

{% block content %}

{% load static %}

<style type="text/css">
  .ck.ck-content ul,
  .ck.ck-content ul li {
    list-style-type: inherit;
  }


  .ck.ck-content ul {
    padding-left: 40px;
  }

  .ck.ck-content strong {
    font-weight: bold;
  }

  .flex-container-space-btw {
    display: flex;
    justify-content: space-between;
  }

  .flex-container-space-btw>div {
    margin-top: 15px;
    width: 7vw;
  }


  .img-wrapper {
    position: relative;
  }

  .img-responsive {
    width: 100%;
    height: auto;
  }

  .img-overlay {
    position: absolute;
    top: 1em;
    bottom: 0;
    right: 1em;
    text-align: center;
  }

  .redd:hover {
    background-color: red !important;
    color: white !important;
  }

  .greenn:hover {
    background-color: #009051 !important;
    color: white !important;
  }

  .bluee:hover {
    background-color: blue !important;
    color: white !important;
  }

  .yelloww:hover {
    background-color: orange !important;
    color: white !important;
  }

  .purplee:hover {
    background-color: #512de8 !important;
    color: white !important;
  }

  .maroonn:hover {
    background-color: maroon !important;
    color: white !important;
  }

  .homee:hover {
    background-color: #521893 !important;
    color: white !important;
  }

  .miniimage+input {
    width: 50% !important;
    display: block;
  }

  input[type="checkbox"].filled-in:checked+span:before {
    background-color: #512de8 !important
  }

  input[type="checkbox"].filled-in:checked+span:after {
    background-color: #512de8 !important
  }

  .img-overlay:before {
    content: ' ';
    display: block;
    height: 10%;
  }


  a .active {
    background-color: #512da8 !important;
  }


  /*tabs*/

  .tab-content {
    margin-top: 20px;
    max-height: 80vh;
    overflow: auto;
    overflow-x: hidden;
  }

  input:focus {
    border-color: #512da8 !important;
  }

  input:select {
    border-color: #512da8 !important;
  }

  .tab-pane div.row {
    padding: 20px !important;
  }

  .savebtn {
    position: fixed;
    top: 20px;
    left: 50px;
    background-color: #512da8;
  }

  li span {
    color: black !important;
  }

  img.materialboxed {
    width: 100px;
    height: 100px;
    background-color: white;
  }

  .tab-pane h4 {
    display: none;
  }

  .miniimage {
    display: block;
    height: 80px;
  }

  .image-section {
    overflow-y: scroll;
    overflow-x: hidden;
  }

  ::-webkit-scrollbar {
    width: 0px;
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: gray;
  }


  .input-field:not(.left-section) {
    padding: 0px 50px 0px 50px !important;
    margin-top: 20px !important;
  }


  input:not([type]),
  input[type=text],
  input[type=password],
  input[type=email],
  input[type=url],
  input[type=time],
  input[type=date],
  input[type=datetime],
  input[type=datetime-local],
  input[type=tel],
  input[type=number],
  input[type=search],
  textarea.materialize-textarea {
    border: none !important;
    border-bottom: 2px solid #f7f7f7 !important;
    padding-left: 10px !important;
    font-family: 'AvenirNext' !important;
    font-weight:
  }

  input:not([type]):focus:not([readonly]),
  input[type=text]:focus:not([readonly]),
  input[type=password]:focus:not([readonly]),
  input[type=email]:focus:not([readonly]),
  input[type=url]:focus:not([readonly]),
  input[type=time]:focus:not([readonly]),
  input[type=date]:focus:not([readonly]),
  input[type=datetime]:focus:not([readonly]),
  input[type=datetime-local]:focus:not([readonly]),
  input[type=tel]:focus:not([readonly]),
  input[type=number]:focus:not([readonly]),
  input[type=search]:focus:not([readonly]),
  
  textarea.materialize-textarea:focus:not([readonly])>label {
    border-bottom: 1px solid #512ea8 !important;
    box-shadow: 0 1px 0 0 #f00 !important;
    border-bottom: none !important;
    box-shadow: none !important;
  }

  label {
    margin-left: 50px !important;
  }

  .input-field:not(.left-section) input:focus+label {
    color: #512ea8 !important;
  }

  .row .input-field:not(.left-section) input:focus {
    border-bottom: 1px solid #512ea8 !important;
    box-shadow: 0 1px 0 0 #512ea8 !important
  }

  .left-section .select-wrapper ul {
    position: relative;
    top: -300px !important;
  }

  .material-placeholder {
    width: 25vw;
    height: 25vw;
  }

  .preview-img {
    height: 100% !important;
    width: 100% !important;
    object-fit: contain;
  }

  body {
    z-index: 100;
  }
</style>



<script src="https://cdn.ckeditor.com/ckeditor5/11.0.1/decoupled-document/ckeditor.js"></script>

<style type="text/css">
  .document-editor {
    border: 1px solid var(--ck-color-base-border);
    border-radius: var(--ck-border-radius);
    max-height: 40em;
    display: flex;
    flex-flow: column nowrap;
  }

  .document-editor__toolbar {
    z-index: 1;
    box-shadow: 0 0 5px hsla(0, 0%, 0%, .2);
    border-bottom: 1px solid var(--ck-color-toolbar-border);
  }

  .document-editor__toolbar .ck-toolbar {
    border: 0;
    border-radius: 0;
  }


  .document-editor__editable-container {
    padding: calc(2 * var(--ck-spacing-large));
    background: var(--ck-color-base-foreground);
    overflow-y: scroll;
  }

  .document-editor__editable-container .ck-editor__editable {
    width: 15.8cm;
    min-height: 21cm;
    padding: 1cm 2cm 2cm;
    border: 1px hsl(0, 0%, 82.7%) solid;
    border-radius: var(--ck-border-radius);
    background: white;
    box-shadow: 0 0 5px hsla(0, 0%, 0%, .1);
    margin: 0 auto;
  }

  .document-editor .ck-content,
  .document-editor .ck-heading-dropdown .ck-list .ck-button__label {
    font: 16px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  }

  .document-editor .ck-heading-dropdown .ck-list .ck-button__label {
    line-height: calc(1.7 * var(--ck-line-height-base) * var(--ck-font-size-base));
    min-width: 6em;
  }

  .document-editor .ck-heading-dropdown .ck-list .ck-button:not(.ck-heading_paragraph) .ck-button__label {
    transform: scale(0.8);
    transform-origin: left;
  }

  .document-editor .ck-content h2,
  .document-editor .ck-heading-dropdown .ck-heading_heading1 .ck-button__label {
    font-size: 2.18em;
    font-weight: normal;
  }

  .document-editor .ck-content h2 {
    line-height: 1.37em;
    padding-top: .342em;
    margin-bottom: .142em;
  }

  .document-editor .ck-content h3,
  .document-editor .ck-heading-dropdown .ck-heading_heading2 .ck-button__label {
    font-size: 1.75em;
    font-weight: normal;
    color: hsl(203, 100%, 50%);
  }

  .document-editor .ck-heading-dropdown .ck-heading_heading2.ck-on .ck-button__label {
    color: var(--ck-color-list-button-on-text);
  }

  .document-editor .ck-content h3 {
    line-height: 1.86em;
    padding-top: .171em;
    margin-bottom: .357em;
  }

  .document-editor .ck-content h4,
  .document-editor .ck-heading-dropdown .ck-heading_heading3 .ck-button__label {
    font-size: 1.31em;
    font-weight: bold;
  }

  .document-editor .ck-content h4 {
    line-height: 1.24em;
    padding-top: .286em;
    margin-bottom: .952em;
  }

  .document-editor .ck-content p {
    font-size: 1em;
    line-height: 1.63em;
    padding-top: .5em;
    margin-bottom: 1.13em;
  }

  .image-section-dropdown .select-wrapper input.select-dropdown {
    border: none !important;
    bottom: 2px !important;
    margin-bottom: 0px !important;
    font-size: 14px !important;
  }

  .document-editor .ck-content blockquote {
    font-family: Georgia, serif;
    margin-left: calc(2 * var(--ck-spacing-large));
    margin-right: calc(2 * var(--ck-spacing-large));
  }

  input.active {
    border-bottom-color: #512da8 !important;
  }

  .scroll-style-2>li>a {
    padding: 0 17px !important;
  }

  .margin-zero {
    margin: 0 !important;
  }

  .sidebar2 {
    padding-left: 0 !important;
  }

  .sidebar2 .row {
    height: 100vh;
    background-color: white;

  }

  .collapse-div-row-container {
    height: 100vh;
    background-color: white !important;
  }

  .collapse-div-container {
    padding: 0 5px 0 0;
  }

  .collapse-div {
    display: inline-block;
    background-color: white;
    padding-right: 5px;
    height: 100vh;
    overflow-y: auto;
  }
</style>



<div>
  <div class="row" style="margin: 10px 35px 0 60px;">
    <div class="toolbar"
      style="position: fixed; top: 0px; left: 0px;padding:20px 5px 20px 5px; height: 100vh; background-color: white;">
      <a class="right" href="#!" onclick="window.close()"
        style="background-color: transparent;display: block;cursor: pointer;">
        <i class="material-icons redd" title="Close" style="
            background-color: #f7f7f7;
            padding: 8px;
            color: gray;
            border-radius: 5px;
            margin-left: 8px;
            font-size: 20px;
            margin-right: 9px;
            display: block;
            margin-bottom: 10px;">
          close
        </i>
      </a>
      </br>

      <a class="right" href="/products" style="background-color: transparent;display: block;cursor: pointer;">
        <i class="material-icons homee" title="Products" style="
          background-color: #f7f7f7;
          padding: 8px;
          color: gray;
          border-radius: 5px;
          margin-left: 8px;
          font-size: 20px;
          margin-right: 9px;
          display: block;
          margin-bottom: 10px;">
          select_all
        </i>
      </a>

      <div style="background-color: transparent; position: absolute;bottom: 15px;right: 4px;">
        
        <a href="#!" class=" right" style="background-color: transparent;display: block;">
          <i id="pending-icon" class="material-icons yelloww" title="Pending" style="
            background-color: #f7f7f7;
            padding: 8px;
            color: gray;
            border-radius: 5px;
            margin-left: 8px;
            font-size: 20px;
            margin-right: 9px;
            display: block;
            margin-bottom: 10px;">
            timer
          </i>
        </a>

        <a href="#!" class=" right" style="background-color: transparent;display: block;">
          <i id="verified-icon" class="material-icons greenn" title="Verified" style="
            background-color: #f7f7f7;
            padding: 8px;
            color: gray;
            border-radius: 5px;
            margin-left: 8px;
            font-size: 20px;
            margin-right: 9px;
            display: block;
            margin-bottom: 10px;">
            verified_user
          </i>
        </a>

        <a href="#!" id="main-image-select-save-btn" class="right"
          style="background-color: transparent;display: block;">
          <i class="material-icons bluee" title="Set Cover Image" style="
            background-color: #f7f7f7;
            padding: 8px;
            color: gray;
            border-radius: 5px;
            margin-left: 8px;
            font-size: 20px;
            margin-right: 9px;
            display: block;
            margin-bottom: 10px;">
            burst_mode
          </i>
        </a>

        <a href="#download-export-list-modal" class="modal-trigger right" style="background-color: transparent;">
          <i class="material-icons greenn" title="Export Product Details" style="
            background-color: #f7f7f7;
            padding: 8px;
            color: gray;
            border-radius: 5px;
            margin-left: 8px;
            font-size: 20px;
            margin-right: 9px;
            display: block;
            margin-bottom: 10px;">
            file_download
          </i>
        </a>

        {% if perms.WAMSApp.change_product %}
        <a href="#!" id="save-btn" class="right" style="background-color: transparent;">
          <i class="material-icons purplee" title="Save" style="
              background-color: #f7f7f7;
              padding: 8px;
              color: gray;
              border-radius: 5px;
              margin-left: 8px;
              font-size: 20px;
              margin-right: 9px;
              display: block;
              margin-bottom: 10px;">
            save
          </i>
        </a>
        {% endif %}
    
      </div>
    
    </div>
    
    <div class="col s4 image-section" style="height: 90vh;">
      <div class="main-image" style="position: relative;">
        <a id="download-image-btn" href="#!" class="right btn-floating btn-small white"
          style="position:absolute;right:5em;top:0em;z-index: 100;"><i class="material-icons"
            style="color: #521893;">file_download</i></a>
      </div>

      <div class="row image-section-dropdown" style="margin-bottom: 0px;">
        <div class="input-field left-section col s7" style="
          width: 21vw;
          border: none; 
          background-color: 
          white;height: 40px; 
          font-size: 14px !important;
          margin-left: 10px;">
          <select id="images-category">
            <option value="All Images" id="all-images-option">All Images</option>
            <option value="Main Images" id="main-images-option">Main Images</option>
            <option value="Sub Images" id="sub-images-option">Sub Images</option>
            </select>
        </div>

        <div class="col s3">
          <a href="#upload-image-modal" id="import-btn" class="modal-trigger">
            <i class="material-icons" title="Add Image" style="
              color: gray;
              background-color: white;
              padding: 8px;
              margin-top: 15px;">
              add_photo_alternate
            </i>
          </a>
        </div>
      </div>

      <div class="row" style="position: relative;bottom: 15px;right: 5px;">
        <div id="graphics-section" class="col s12" style="width: 94%;padding-top: 1.11em;">

        </div>
      </div>
    </div>

    <div id="collapse-div" class="col s8 center collapse-div-container"
      style="display: inline-block;transition: width 0.5s;">

      <div class="collapse-div">
        <div class="scroll-style-1 ">
          <h6 style="color: #521893;">Amazon UK</h6>
          <div class="collapse-div-row-container">
            
            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="product-name" type="text">
                <label for="product-name">Product Name</label>
              </div>
              <div class="input-field col s6">
                <input disabled id="product-id" type="text" class="deep-purple-text">
                <label for="product-id">Product ID</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="feed-product-type" type="text">
                <label for="feed-product-type">Feed Product Type</label>
              </div>
              <div class="input-field col s6">
                <input id="product-variation-theme" type="text">
                <label for="product-variation-theme">Variation Theme</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <select id="update-delete">
                  <option value="Update" selected>Update</option>
                  <option value="Delete">Delete</option>
                </select>
                <label for="update-delete">Update Delete</label>
              </div>
              <div class="input-field col s6">
                <input id="recommended-browse-nodes" type="text">
                <label for="recommended-browse-nodes">Recommended Browse Nodes</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="search-terms" type="text">
                <label for="search-terms">Search Terms</label>
              </div>
              <div class="input-field col s6">
                <input id="enclosure-material" type="text">
                <label for="enclosure-material">Enclosure Material</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="cover-material-type" type="text">
                <label for="cover-material-type">Cover Material Type</label>
              </div>
              <div class="input-field col s6">
                <input id="sale-price" type="number">
                <label for="sale-price">Sale Price</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="sale-from" type="date">
                <label for="sale-from">Sale From</label>
              </div>

              <div class="input-field col s6">
                <input id="sale-end" type="date">
                <label for="sale-end">Sale End</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s9">
                <input id="special-feature-1" type="text">
                <label for="special-feature-1">Special Feature</label>
              </div>

              <div class="input-field col s1">
                <a id="add-special-feature-btn" href="#!" class="btn-floating blue"
                  style="background-color: #512ea8 !important; transform: scale(0.7);box-shadow: none;"><i
                    class="material-icons">add</i></a>
              </div>

              <div id="special-features-div">
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s4" style="padding: 0px 20px 0px 50px  !important;">
                <input id="wattage" type="number">
                <label for="wattage">Wattage</label>
              </div>

              <div class="input-field col s2" style="padding: 0px 40px 0px 10px !important;">
                <select id="wattage-metric">
                  <option selected value="">Unit</option>
                  <option value="volts">V</option>
                  <option value="Watts">W</option>
                  <option value="Kilowatts">KW</option>
                </select>
              </div>

              <div class="input-field col s6">
                <input disabled id="material-type" type="text" class="deep-purple-text">
                <label for="material-type">Material Type</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="parentage" type="text">
                <label for="parentage">Parentage</label>
              </div>
              <div class="input-field col s6">
                <input id="parent-sku" type="text">
                <label for="parent-sku">Parent SKU</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="relationship-type" type="text">
                <label for="relationship-type">Relationship Type</label>
              </div>

              <div class="input-field col s4" style="padding: 0px 20px 0px 40px  !important;">
                <input id="item-count" type="number">
                <label for="item-count">Item Count</label>
              </div>

              <div class="input-field col s2" style="padding: 0px 40px 0px 10px !important;">
                <select id="item-count-metric">
                  <option selected value="">Unit</option>
                  <option value="Bag">Bag</option>
                  <option value="Box">Box</option>
                  <option value="Dzn">Dzn</option>
                  <option value="Mah">Mah</option>
                  <option value="Pieces">Pieces</option>
                  <option value="Packet">Packet</option>
                </select>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="item-condition-note" type="text">
                <label for="item-condition-note">Item Condition Note</label>
              </div>
              <div class="input-field col s6">
                <input id="max-order-quantity" type="text">
                <label for="max-order-quantity">Max Order Quantity</label>
              </div>
            </div>

            <div class="row margin-zero">
              <div class="input-field col s6">
                <input id="number-of-items" type="text">
                <label for="number-of-items">Number of Items</label>
              </div>
              <div class="input-field col s6">
                <select id="condition-type">
                  <option value="New" selected>New</option>
                  <option value="Old">Old</option>
                </select>
                <label for="condition-type">Condition Type</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="sidebar2" class="col s4 sidebar2" style="display: none;">
      <div class="row margin-zero">
        <div class="input-field col s12">
          <select id="reference-channel">
            <option value="" selected>Select Channel</option>
            <option value="">Amazon UAE</option>
            <option value="">Ebay</option>
            <option value="">Noon</option>
          </select>
          <label>Channels</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-product-name" type="text" class="deep-purple-text">
          <label for="product-name">Product Name</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-product-type" type="text" class="deep-purple-text">
          <label for="product-type">Product Type</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-product-subtype" type="text" class="deep-purple-text">
          <label for="product-subtype">Product Subtype</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-model-no" type="text" class="deep-purple-text">
          <label for="product-model-no">Model No.</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-model-name" type="text" class="deep-purple-text">
          <label for="product-model-name">Model Name</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-model-name" type="text" class="deep-purple-text">
          <label for="product-msrp">MRP</label>
        </div>
        <div class="input-field col s6">
          <input disabled id="sidenav-product-description" type="text" class="deep-purple-text">
          <label for="sidenav-product-description">Description</label>
        </div>

      </div>
    </div>

    <div class="toolbar"
      style="position: fixed; top: 0px; right: 0px;padding:20px 5px 20px 5px; height: 100vh; background-color: white;">
      <a id="open-it-btn" visible="no" href="#" class="button-collapse show-on-large">
        <i class="material-icons">keyboard_arrow_left</i>
      </a>

    </div>

  </div>
</div>


<div id="upload-image-modal" class="modal">
  <div class="modal-content">
    <h4 style="font-family:'AvenirNext';font-size:18px;">Upload Image</h4>
    <div class="file-field input-field">
      <div class="btn" style="background-color: #512da8">
        <span style="font-size:14px;">File</span>
        <input id="product-image-input" type="file" multiple>
      </div>
      <div class="file-path-wrapper">
        <input class="file-path validate" type="text">
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
    <a id="upload-image-btn" href="#!" class="waves-effect waves-green btn-flat blue white-text"
      style="background-color:#009051 !important ;">Upload</a>
    <div class="progress" id="upload-preloader"
      style="display:none;margin: 0px !important;background-color: white !important;">
      <div class="indeterminate" style="background-color: #512de8;"></div>
    </div>
  </div>
</div>


<div id="delete-image-modal" class="modal">
  <div class="modal-content">
    <h4 style="font-family:'AvenirNext';font-size:18px;">Are you sure you want to delete the image?</h4>
  </div>
  <div class="modal-footer">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
    <a id="delete-image-btn" href="#!" class="red waves-effect waves-red btn-flat white-text">Delete</a>
  </div>
</div>


<div id="download-export-list-modal" class="modal" style="border-radius: 5px;">
  <div class="modal-content">
    <h5 style="font-family: 'AvenirNext';font-size: 18px;">EXPORT PRODUCT</h5>
    <br>
    <div class="row">
      <div class="input-field col s6" style="padding-left: 0em !important;">
        <select id="export-format">
          <option value="Amazon UK" selected>Amazon UK</option>
          <option value="Amazon UAE">Amazon UAE</option>
          <option value="Ebay">Ebay</option>
          <option value="Noon">Noon</option>
          <!-- <option value="Ebay" style="font-family: 'AvenirNextRegular';">Ebay</option>   -->
        </select>
        <label style="margin-left: 0em !important;">Export Format</label>
      </div>

      <div class="input-field col s6">
      </div>
    </div>
  </div>
  <div class="modal-footer" style="margin-bottom: 15px">
    <a href="#!" class="modal-close waves-effect btn-flat" style="margin-right: 20px;">Close</a>
    <a id="download-product-btn" href="#!" class="waves-effect btn-flat white-text"
      style="margin-right: 20px;background-color: #521893 !important;">Download</a>
  </div>
</div>


<script type="text/javascript" src="{% static 'WAMSApp/js/html2canvas.js' %}"></script>
<script type="text/javascript" src="{% static 'WAMSApp/js/canvas2image.js' %}"></script>
<script type="text/javascript">

  
  function getCsrfToken() {
    var CSRF_TOKEN = $('input[name="csrfmiddlewaretoken"]').val();
    return CSRF_TOKEN;
  }

  //Initiate
  $('.tabs').tabs();
  $('.chips').chips();
  $('select').formSelect();
  $('.modal').modal();
  $('body').css('background-color', '#ebebeb');
  $('.sidenav').sidenav({ edge: 'left' });


  $("#open-it-btn").click(function () {
    if ($(this).attr("visible") == "no") {
      $(this).attr("visible", "yes");
      $("#collapse-div").attr("class", "col s4 center");
      $("#sidebar2").show(600);

    }
    else {
      $(this).attr("visible", "no");
      $("#sidebar2").hide();
      $("#collapse-div").attr("class", "col s8 center");
    }
  })

  var global_details_amazon_uk = {};
  var global_details_amazon_uae = {};
  var global_details_ebay = {};
  var global_details_noon = {};
  var global_product_id = "";
  var global_material_type = "";
  
  function fetch_details_amazon_uk()
  {
    console.log("Here");
    $.ajax({
      url: "/fetch-channel-product-amazon-uk/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_product_id = response["product_id"];
          global_details_amazon_uk = response["amazon_uk_product_json"];
          global_material_type = response["material_type"];
          render_amazon_uk();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  function fetch_details_amazon_uae()
  {
    $.ajax({
      url: "/fetch-channel-product-amazon-uae/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_details_amazon_uae = response["amazon_uae_product_json"];
          // render_amazon_uk();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  function fetch_details_noon()
  {
    $.ajax({
      url: "/fetch-channel-product-noon/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_details_noon = response["noon_product_json"];
          // render_amazon_uk();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  function fetch_details_ebay()
  {
    $.ajax({
      url: "/fetch-channel-product-ebay/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);
        if(response["status"]==200)
        {
          global_details_ebay = response["ebay_product_json"];
          
          // render_amazon_uk();
        }
        else
        {
          M.toast({ html: "Internal Server" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  
  fetch_details_amazon_uk();

  
  function render_amazon_uk()
  {

    $("#product-id").val(global_product_id);
    $("#material-type").val(global_material_type);
    $("#product-name").val(global_details_amazon_uk["product_name"]);
    $("#feed-product-type").val(global_details_amazon_uk["feed_product_type"]);
    $("#variation-theme").val(global_details_amazon_uk["variation_theme"]);
    $("#update-delete").val(global_details_amazon_uk["update_delete"]);
    $("#recommended-browse-nodes").val(global_details_amazon_uk["recommended_browse_nodes"]);
    $("#search-terms").val(global_details_amazon_uk["search_terms"]);
    $("#enclosure-material").val(global_details_amazon_uk["enclosure_material"]);
    $("#cover-material-type").val(global_details_amazon_uk["cover_material_type"]);
    $("#sale-price").val(global_details_amazon_uk["sale_price"]);
    $("#sale-from").val(global_details_amazon_uk["sale_from"]);
    $("#sale-end").val(global_details_amazon_uk["sale_end"]);

    var special_feature_data = global_details_amazon_uk["special_features"];
    if(special_feature_data.length>0)
    {
      $("#special-feature-1").val(special_feature_data[0]);
    }
    for(var i=1;i<special_feature_data.length;i++)
    {
      $("#add-special-feature-btn").click();
      $("#special-feature-" + (i+1)).val(special_feature_data[i]);
      
    }
    
    $("#wattage").val(global_details_amazon_uk["wattage"]);
    $("#wattage-metric").val(global_details_amazon_uk["wattage_metric"]);
    $("#parentage").val(global_details_amazon_uk["parentage"]);
    $("#parent-sku").val(global_details_amazon_uk["parent_sku"]);
    $("#relationship-type").val(global_details_amazon_uk["relationship_type"]);
    $("#item-count").val(global_details_amazon_uk["item_count"]);
    $("#item-count-metric").val(global_details_amazon_uk["item_count_metric"]);
    $("#item-condition-note").val(global_details_amazon_uk["item_condition_note"]);
    $("#max-order-quantity").val(global_details_amazon_uk["max_order_quantity"]);
    $("#number-of-items").val(global_details_amazon_uk["number_of_items"]);
    $("#condition-type").val(global_details_amazon_uk["condition_type"]);


    M.updateTextFields();

  }


  var global_verification_status = false;
  var global_delete_image_pk = null;

  //Page reload prevent logic
  let savecounter = false;
  $('#save-btn').click(() => {
    savecounter = false;
  })

  $('input').click(function () {
    savecounter = true;
  })

  function preventDefault() {
    if (savecounter) {
      alert('Please save the details before refreshing!');
    }
    else {
      window.close();
    }
  }

  $('#close-btn').click(function () {
    preventDefault();
  })


  $("#download-product-btn").click(function () {

    var export_format = $("#export-format").val();

    $.ajax({
      url: "/download-product/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        product_pk: window.location.pathname.split("/")[3],
        export_format: export_format
      },
      success: function (response) {
        console.log("Success!", response);
        $("#download-export-list-modal").modal("close");
        var file_path = response["file_path"]
        window.open(file_path);
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });

  });

  window.addEventListener('beforeunload', function (e) {
    if (savecounter) {
      e.preventDefault();
      e.returnValue = '';
    }
    else
      window.close();
  });

  $("#pending-icon").click(function () {
    if (global_verification_status) {
      call_verify_api(0);
    }
  });

  $("#verified-icon").click(function () {
    if (!global_verification_status) {
      call_verify_api(1);
    }
  });

  function call_verify_api(verify) {
    var fd = new FormData()
    fd.append("product_pk", window.location.pathname.split("/")[3]);
    fd.append("verify", verify);

    $.ajax({
      url: "/verify-product/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      processData: false,
      contentType: false,
      data: fd,
      success: function (response) {
        console.log("Success!", response);
        if (response["status"] == 200) {
          if (verify == 1) {
            set_verify(true);
            global_verification_status = true;
            M.toast({ html: "Product status changed to verified" });
          }
          else {
            set_verify(false);
            global_verification_status = false;
            M.toast({ html: "Product status changed to pending" });
          }
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have access to update the status!" });
        }
        else {
          M.toast({ html: "Error updating the status!" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  $(document).ready(function () {
    $('.tabs').tabs();
  });

  $('#barcode-string').characterCounter();

  $("#download-image-btn").click(function () {

    $("#download-image-btn").attr("disabled", "disabled");
    var high_def_url = $($(".preview-img")[0]).attr("high_def_url");
    var image_links = [];
    image_links.push({
      "key": "high_def_url",
      "url": high_def_url
    })

    $.ajax({
      url: "/download-images-s3/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        links: JSON.stringify(image_links)
      },
      success: function (response) {
        console.log("Success! ", response);
        $("#download-image-btn").removeAttr("disabled");
        if (response["status"] == 200) {
          var local_link = response["local_links"][0]["url"];

          var a = document.createElement('a');
          a.href = local_link;
          var filename = high_def_url.split("/")[high_def_url.split("/").length - 1];
          a.download = filename;
          a.click();
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        $("#download-image-btn").removeAttr("disabled");
      }
    });
  });

  $("#heading-title").html("PRODUCT FORM");

  var global_images = {};
  var global_image_key = "all_images";

  function fetch_product_images_details() {

    $.ajax({
      url: "/fetch-product-details/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        pk: window.location.pathname.split("/")[3]
      },
      success: function (response) {
        console.log("Success!", response);

        if (response["status"] == 200) {
          $('.material-placeholder').remove();
          $('.main-image').append(`<img class = "preview-img materialboxed" src='` + response["repr_image_url"] + `' high_def_url="` + response["repr_high_def_url"] + `">`)
          $('.materialboxed').materialbox();

          global_images = response["images"];

          $("#all-images-option").html("All Images (" + global_images["all_images"].length + ")");
          $("#main-images-option").html("Main Images (" + global_images["main_images"].length + ")");
          $("#sub-images-option").html("Sub Images (" + global_images["sub_images"].length + ")");
          
          update_grid_images(global_image_key);

          M.updateTextFields();
          $('select').formSelect();
        }
        else {
          M.toast({ html: "Error fetching images information" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }


  $("#upload-image-btn").click(function () {

    $("#upload-image-btn").attr("disabled", "disabled");
    $("#upload-preloader").show();

    product_pk = window.location.pathname.split("/")[3];

    var fd = new FormData();

    fd.append("product_pk", product_pk);
    var product_image_input = document.getElementById("product-image-input");

    fd.append('image_count', product_image_input.files.length);
    for (var i = 0; i < product_image_input.files.length; i++) {
      fd.append('image_' + i, product_image_input.files[i]);
    }


    fd.append('image_category', global_image_key);

    $.ajax({
      url: "/upload-product-image/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      processData: false,
      contentType: false,
      data: fd,
      success: function (response) {
        console.log("Success!", response);
        $("#upload-preloader").hide();
        $("#upload-image-btn").removeAttr("disabled");

        if (response["status"] == 200) {
          $("#upload-image-modal").modal("close");
          M.toast({ html: "Successfully uploaded images!" });
          fetch_product_images_details();
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have permission to upload images!" });
        }
        else {
          M.toast({ html: "Error uploading images!" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
        $("#upload-preloader").hide();
      }
    });
  })

  function set_verify(verified) {
    if (verified == true) {
      $("#pending-icon").css("background-color", "#f7f7f7");
      $("#pending-icon").css("color", "gray");
      $("#verified-icon").css("background-color", "#009051");
      $("#verified-icon").css("color", "white");
    }
    else {
      $("#verified-icon").css("background-color", "#f7f7f7");
      $("#verified-icon").css("color", "gray");
      $("#pending-icon").css("background-color", "orange");
      $("#pending-icon").css("color", "white");
    }
  }

  var product_attribute_amazon_uk_cnt = 1;
  $("#add-product-attribute-amazon-uk-btn").click(function () {
    product_attribute_amazon_uk_cnt++;

    var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-amazon-uk-`+ product_attribute_amazon_uk_cnt + `" type="text" >
                           <label for="product-attribute-amazon-uk-`+ product_attribute_amazon_uk_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-amazon-uk-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
    $("#product-attributes-amazon-uk-div").append(html_string);
  });

  $(document).on("click", ".remove-product-attribute-amazon-uk-btn", function () {
    $(this).parent().parent().remove();
  });


  var product_attribute_amazon_uae_cnt = 1;
  $("#add-product-attribute-amazon-uae-btn").click(function () {
    product_attribute_amazon_uae_cnt++;

    var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-amazon-uae-`+ product_attribute_amazon_uae_cnt + `" type="text" >
                           <label for="product-attribute-amazon-uae-`+ product_attribute_amazon_uae_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-amazon-uae-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                      </div>`
    $("#product-attributes-amazon-uae-div").append(html_string);
  });

  $(document).on("click", ".remove-product-attribute-amazon-uae-btn", function () {
    $(this).parent().parent().remove();
  });


  var product_attribute_ebay_cnt = 1;
  $("#add-product-attribute-ebay-btn").click(function () {
    product_attribute_ebay_cnt++;

    var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-ebay-`+ product_attribute_ebay_cnt + `" type="text" >
                           <label for="product-attribute-ebay-`+ product_attribute_ebay_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-ebay-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
    $("#product-attributes-ebay-div").append(html_string);
  });

  $(document).on("click", ".remove-product-attribute-ebay-btn", function () {
    $(this).parent().parent().remove();
  });




  var product_attribute_noon_cnt = 1;
  $("#add-product-attribute-noon-btn").click(function () {
    product_attribute_noon_cnt++;

    var html_string = `<div>
                         <div class="input-field col s9">
                           <input id="product-attribute-noon-`+ product_attribute_noon_cnt + `" type="text" >
                           <label for="product-attribute-noon-`+ product_attribute_noon_cnt + `">Product Attribute</label>
                         </div>
                         <div class="input-field col s1">
                           <a href="#!" class="remove-product-attribute-noon-btn btn-floating red" style="background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                         </div>
                       </div>`
    $("#product-attributes-noon-div").append(html_string);
  });

  $(document).on("click", ".remove-product-attribute-noon-btn", function () {
    $(this).parent().parent().remove();
  });




  var special_feature_cnt = 1;
  $("#add-special-feature-btn").click(function () {
    special_feature_cnt++;

    var html_string = `<div>
                           <div class="input-field col s9">
                             <input id="special-feature-`+ special_feature_cnt + `" type="text" >
                             <label for="special-feature-`+ special_feature_cnt + `">Special Feature</label>
                           </div>

                           <div class="input-field col s1">
                             <a href="#!" class="remove-special-feature-btn btn-floating blue" style = "background-color: red !important; transform: scale(0.7);box-shadow: none;"><i class="material-icons">delete</i></a>
                           </div>
                        </div>`
    $("#special-features-div").append(html_string);
  });

  $(document).on("click", ".remove-special-feature-btn", function () {
    $(this).parent().parent().remove();
  });


  function update_grid_images_main_images(key) {
    var html_string = "";
    for (var i = 0; i < global_images[key].length; i++) {
      var checked = "";
      if (global_images[key][i]["is_main_image"] == true) {
        checked = "checked";
      }

      if (i % 3 == 0) {
        html_string += "<div class='flex-container-space-btw' style='margin-top:0em;margin-bottom:0em;padding-top:0em !important;padding-bottom:0em !important;width:25.5vw !important;'>";
      }

      html_string += `<div style=";position:relative;">
                        <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:2px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
                          <i class="material-icons redd" title="Delete Image" style="
                            background-color: transparent;
                            padding: 4px;
                            color: gray;
                            border-radius: 2px;
                            margin-left: 4px;
                            font-size: 10px;
                            margin-right: 4px;
                            display: block;
                            margin-bottom: 5px;">
                            close
                          </i>
                        </a>
                        <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `"  style="width: 100%;object-fit:contain;">
                        <label style="margin-left:0px !important;">
                          <input value="`+ global_images[key][i]["pk"] + `" name="group1" type="radio" ` + checked + ` />
                          <span class = "checkbox"></span>
                        </label>
                      </div>`;

      if (i % 3 == 2 || i == global_images[key].length - 1) {
        html_string += "</div>";
      }
    }

    $("#graphics-section").html(html_string);
  }


  $(document).on('click', '.miniimage', function () {
    let url = $(this).attr('midimage_url');
    let high_def_url = $(this).attr('high_def_url');
    $('.material-placeholder').remove();
    $('.main-image').append(`<img class = "preview-img materialboxed" src = '` + url + `' high_def_url="` + high_def_url + `">`)
    $('.materialboxed').materialbox();
  });

  $(document).on("click", ".delete-image-modal-btn", function () {
    global_delete_image_pk = this.id.split("-")[1];
  })

  $("#delete-image-btn").click(function () {
    delete_image();
  })

  function delete_image() {
    var image_type = "";
    if (global_image_key == "sub_images" || global_image_key == "main_images") {
      image_type = "main_sub";
    }
    else {
      image_type = "other";
    }

    var fd = new FormData();
    fd.append("image_pk", global_delete_image_pk);
    fd.append("image_type", image_type);

    $.ajax({
      url: "/delete-image/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      processData: false,
      contentType: false,
      data: fd,
      success: function (response) {
        console.log("Success!", response);
        if (response["status"] == 200) {
          M.toast({ html: "Image successfully deleted!" });
          $("#delete-image-modal").modal("close");
          fetch_product_images_details();
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have permission to delete images!" });
        }
        else {
          M.toast({ html: "Error deleting image!" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }

  $("#main-image-select-save-btn").click(function () {

    if (global_image_key != "main_images") {
      return;
    }

    var fd = new FormData();

    var checked_pk = $("input[name=group1]:checked").val();
    fd.append("checked_pk", checked_pk);
    fd.append("product_pk", window.location.pathname.split("/")[3]);

    $.ajax({
      url: "/update-main-image/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      processData: false,
      contentType: false,
      data: fd,
      success: function (response) {
        console.log("Success!", response);
        if (response["status"] == 200) {
          M.toast({ html: "Main image updated successfully!" });
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have permission to update main image!" });
        }
        else {
          M.toast({ html: "Error updating main image!" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  });


  function update_grid_images_sub_images(key) {
    var html_string = "";
    for (var i = 0; i < global_images[key].length; i++) {
      var checked = "";
      if (global_images[key][i]["is_sub_image"] == true) {
        checked = "checked";
      }

      if (i % 3 == 0) {
        html_string += "<div class='flex-container-space-btw' style='margin-top:0em;margin-bottom:0em;padding-top:0em !important;padding-bottom:0em !important;width:25.5vw !important;'>";
      }

      var sub_image_index = global_images[key][i]["sub_image_index"];
      if (sub_image_index == 0)
        sub_image_index = "-"

      html_string += `<div class="" style="position:relative;">
                        <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:4px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
                          <i class="material-icons redd" title="Delete Image" style="
                            background-color: transparent;
                            padding: 4px;
                            color: gray;
                            border-radius: 2px;
                            margin-left: 4px;
                            font-size: 10px;
                            margin-right: 4px;
                            display: block;
                            margin-bottom: 5px;">
                            close
                          </i>
                        </a>
                        <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `" style="width: 100%;object-fit:contain;">
                        <input value="`+ sub_image_index + `" id="subcheck_` + global_images[key][i]["pk"] + `" type="text">
                      </div>`;

      if (i % 3 == 2 || i == global_images[key].length - 1) {
        html_string += "</div>";
      }
    }
    $("#graphics-section").html(html_string);
  }

  function save_subimages_index() {
    if (global_image_key != "sub_images") {
      return;
    }
    var fd = new FormData();

    var sub_image = [];
    var key = "sub_images";

    // Check for condition
    var unique_sub_index = [];
    for (var i = 0; i < global_images[key].length; i++) {
      var sub_image_index = $("#subcheck_" + global_images[key][i]["pk"]).val().trim();
      if (sub_image_index != "-" && sub_image_index != "") {
        sub_image_index = parseInt(sub_image_index);
        if (sub_image_index >= 1 && sub_image_index <= 8) {
          console.log("Key: ", sub_image_index);
          if (unique_sub_index.includes(sub_image_index)) {
            M.toast({ html: "Sub Image indices must be unique" })
            return;
          }

          unique_sub_index.push(sub_image_index);
        }
        else {
          M.toast({ html: "Sub Image indices must be between 1 to 8" })
          return;
        }
      }
    }


    for (var i = 0; i < global_images[key].length; i++) {
      var temp_dict = {};
      temp_dict["pk"] = global_images[key][i]["pk"];
      var sub_image_index = $("#subcheck_" + global_images[key][i]["pk"]).val();
      if (sub_image_index == "" || sub_image_index == "-")
        sub_image_index = "0"
      temp_dict["sub_image_index"] = sub_image_index;
      sub_image.push(temp_dict);
    }

    fd.append("sub_images", JSON.stringify(sub_image));
    fd.append("product_pk", window.location.pathname.split("/")[3]);

    $.ajax({
      url: "/update-sub-images/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      processData: false,
      contentType: false,
      data: fd,
      success: function (response) {
        console.log("Success!", response);
        if (response["status"] == 200) {
          M.toast({ html: "Sub images updated successfully!" });
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have permission to update sub images!" });
        }
        else {
          M.toast({ html: "Error updating sub images!" });
        }
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });
  }


  function update_grid_images(key) {
    if (key == "all_images") {
      $("#import-btn").attr("class", "disabled");
    }
    else {
      $("#import-btn").attr("class", "modal-trigger");
    }

    if (key == "main_images") {
      update_grid_images_main_images(key);
      return;
    }


    if (key == "sub_images") {
      update_grid_images_sub_images(key);
      return;
    }


    var html_string = "";
    for (var i = 0; i < global_images[key].length; i++) {
      html_string += `<div class="col s4" style="padding:1em;">
                        <div style="position:relative;">
                          <a href="#delete-image-modal" id="delimg-`+ global_images[key][i]["pk"] + `" class="delete-image-modal-btn modal-trigger right" style="position:absolute;top:4px;right:2px;z-index:100;background-color: transparent;display: block;cursor: pointer;" title="Delete Image">
                            <i class="material-icons redd" title="Delete Image" style="
                              background-color: transparent;
                              padding: 4px;
                              color: gray;
                              border-radius: 2px;
                              margin-left: 4px;
                              font-size: 10px;
                              margin-right: 4px;
                              display: block;
                              margin-bottom: 5px;">
                              close
                            </i> 
                          </a> 
                          <img class="miniimage" src="`+ global_images[key][i]["thumbnail-url"] + `" midimage_url="` + global_images[key][i]["midimage-url"] + `" high_def_url="` + global_images[key][i]["main-url"] + `" style="width: 100%;object-fit:contain;">
                        </div>
                      </div>`;
    }

    $("#graphics-section").html(html_string);
  }



  $("#images-category").change(function () {
    if ($("#images-category").val() == "All Images") {
      update_grid_images("all_images");
      global_image_key = "all_images";
    }
    else if ($("#images-category").val() == "Main Images") {
      update_grid_images("main_images");
      global_image_key = "main_images";
    }
    else if ($("#images-category").val() == "Sub Images") {
      update_grid_images("sub_images");
      global_image_key = "sub_images";
    }
    
  });


  function save_product_amazon_uk() {

    $("#save-btn").attr("disabled", "disabled");

    var product_pk = window.location.pathname.split("/")[3];

    var product_name = $("#product-name").val();
    var feed_product_type = $("#feed-product-type").val();
    var variation_theme = $("#variation-theme").val();
    var update_delete = $("#update-delete").val();
    var recommended_browse_nodes = $("#recommended-browse-nodes").val();
    var search_terms = $("#search-terms").val();
    var enclosure_material = $("#enclosure-material").val();
    var cover_material_type = $("#cover-material-type").val();
    var sale_price = $("#sale-price").val();
    var sale_from = $("#sale-from").val();
    var sale_end = $("#sale-end").val();

    var special_feature_data = [];
    for (var i = 1; i <= special_feature_cnt; i++) {
      if ($("#special-feature-" + i).val() != "") {
        special_feature_data.push($("#special-feature-" + i).val());
      }
    }
    // special_feature_data = JSON.stringify(special_feature_data);

    var wattage = $("#wattage").val();
    var wattage_metric = $("#wattage-metric").val();
    var parentage = $("#parentage").val();
    var parent_sku = $("#parent-sku").val();
    var relationship_type = $("#relationship-type").val();
    var item_count = $("#item-count").val();
    var item_count_metric = $("#item-count-metric").val();
    var item_condition_note = $("#item-condition-note").val();
    var max_order_quantity = $("#max-order-quantity").val();
    var number_of_items = $("#number-of-items").val();
    var condition_type = $("#condition-type").val();

    // var product_attribute_data_amazon_uk = [];
    // for (var i = 1; i <= product_attribute_amazon_uk_cnt; i++) {
    //   if ($("#product-attribute-amazon-uk-" + i).val() != "") {
    //     product_attribute_data_amazon_uk.push($("#product-attribute-amazon-uk-" + i).val());
    //   }
    // }
    // product_attribute_data_amazon_uk = JSON.stringify(product_attribute_data_amazon_uk);


    amazon_uk_product_json = {}

    amazon_uk_product_json["product_name"] = product_name;
    amazon_uk_product_json["feed_product_type"] = feed_product_type;
    amazon_uk_product_json["variation_theme"]  = variation_theme;
    amazon_uk_product_json["'update_delete"] = update_delete;
    amazon_uk_product_json["recommended_browse_nodes"] = recommended_browse_nodes;
    amazon_uk_product_json["search_terms"] = search_terms;
    amazon_uk_product_json["enclosure_material"] = enclosure_material;
    amazon_uk_product_json["cover_material_type"] = cover_material_type;
    amazon_uk_product_json["sale_price"] = sale_price;
    amazon_uk_product_json["sale_from"] = sale_from;
    amazon_uk_product_json["sale_end"] = sale_end;
    amazon_uk_product_json["special_features"] = special_feature_data;
    amazon_uk_product_json["wattage"] = wattage;
    amazon_uk_product_json["wattage_metric"] = wattage_metric;
    amazon_uk_product_json["parentage"] = parentage;
    amazon_uk_product_json["parent_sku"] = parent_sku;
    amazon_uk_product_json["relationship_type"] = relationship_type;
    amazon_uk_product_json["item_count"] = item_count;
    amazon_uk_product_json["item_count_metric"] = item_count_metric;
    amazon_uk_product_json["item_condition_note"] = item_condition_note;
    amazon_uk_product_json["max_order_quantity"] = max_order_quantity;
    amazon_uk_product_json["number_of_items"] = number_of_items;
    amazon_uk_product_json["condition_type"] = number_of_items;

    $.ajax({
      url: "/save-channel-product-amazon-uk/",
      type: "POST",
      headers: {
        'X-CSRFToken': getCsrfToken()
      },
      data: {
        amazon_uk_product_json : JSON.stringify(amazon_uk_product_json),
        product_pk : product_pk
      },
      success: function (response) {
        console.log("Success!", response);
        if (response["status"] == 200) {
          global_details_amazon_uk = amazon_uk_product_json;
          render_amazon_uk();
          M.toast({ html: "Product saved successfully!" });
        }
        else if (response["status"] == 403) {
          M.toast({ html: "You do not have permission for saving product!" });
        }
        else {
          M.toast({ html: "Error saving product!" });
        }
        $("#save-btn").removeAttr("disabled");
      },
      error: function (xhr, textstatus, errorthrown) {
        console.log("Please report this error: " + errorthrown + xhr.status + xhr.responseText);
      }
    });

  }


  $("#save-btn").click(function () {
    console.log("Hii");
    save_product_amazon_uk();
  });


  $(window).keydown(function (event) {
    console.log(event.which, event.keyCode, event.ctrlKey);
    if (event.which == 83 && event.ctrlKey) {
      event.preventDefault();
      save_product();
      return false;
    }
  });
</script>

{% endblock %}