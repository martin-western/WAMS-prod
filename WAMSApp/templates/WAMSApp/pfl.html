{% load static %}

<!DOCTYPE html>
<html lang="en" style="height: 100%;">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  
  <title>OmnyComm</title>

  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"> -->
  <link rel="stylesheet" href="{% static 'WAMSApp/css/materialize.min.css' %}">

  <link href="{% static 'WAMSApp/css/style.css' %}" type="text/css" rel="stylesheet" media="screen,projection"/>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.3.0/gridstack.min.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

</head>

<body>


  <style type="text/css">
    @font-face {
      font-family: AvenirNext;
      src: url("{% static 'WAMSApp/fonts/Avenir-Next-Font/AvenirNextLTPro-Demi.otf' %}");
    }

    @font-face {
      font-family: AvenirNextBold;
      src: url("{% static 'WAMSApp/fonts/Avenir-Next-Font/AvenirNextLTPro-Bold.otf' %}");
    }

    @font-face {
      font-family: AvenirNextRegular;
      src: url("{% static 'WAMSApp/fonts/Avenir-Next-Font/AvenirNextLTPro-Regular.otf' %}");
    }

     @font-face {
      font-family: Helvetica;
      src: url("{% static 'WAMSApp/fonts/Helvetica/Helvetica.ttf' %}");
    }

    @font-face {
      font-family: BebasNeueRegular;
      src: url("{% static 'WAMSApp/fonts/general/BebasNeueRegular.otf' %}");
    }

    @font-face {
      font-family: GothamBookRegular;
      src: url("{% static 'WAMSApp/fonts/general/GothamBookRegular.otf' %}");
    }

    @font-face {
      font-family: FrankRegular;
      src: url("{% static 'WAMSApp/fonts/general/FrankRegular.otf' %}");
    }

    .scroll-style-1::-webkit-scrollbar-track
    {
      -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.3);
      background-color: #F5F5F5;
    }

    .scroll-style-1::-webkit-scrollbar
    {
      width: 3px;
      background-color: #F5F5F5;
    }

    .scroll-style-1::-webkit-scrollbar-thumb
    {
      background-color: #521893;
    }

    ul.dropdown-content.select-dropdown li span {
        color: #521893;
        font-size: 14px;
        font-family: 'AvenirNext'; 
    }

    .select-wrapper input.select-dropdown {
      font-size: 14px;
      font-family: 'AvenirNext'; 
      color: #521893;
    }

    .spinner-layer{
      border-color: white;  
    }



.custom-slider::-webkit-slider-thumb {
  background-color: #521893 !important;
}

input[type=range]+.thumb {  
  background-color: #521893;  
}

.grid-stack > .grid-stack-item {
  min-width: 4.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="1"] {
  width: 4.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="1"] {
  left: 4.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="1"] {
  min-width: 4.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="1"] {
  max-width: 4.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="2"] {
  width: 8.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="2"] {
  left: 8.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="2"] {
  min-width: 8.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="2"] {
  max-width: 8.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="3"] {
  width: 12.5%;
}
.grid-stack > .grid-stack-item[data-gs-x="3"] {
  left: 12.5%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="3"] {
  min-width: 12.5%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="3"] {
  max-width: 12.5%;
}
.grid-stack > .grid-stack-item[data-gs-width="4"] {
  width: 16.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="4"] {
  left: 16.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="4"] {
  min-width: 16.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="4"] {
  max-width: 16.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="5"] {
  width: 20.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="5"] {
  left: 20.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="5"] {
  min-width: 20.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="5"] {
  max-width: 20.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="6"] {
  width: 25%;
}
.grid-stack > .grid-stack-item[data-gs-x="6"] {
  left: 25%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="6"] {
  min-width: 25%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="6"] {
  max-width: 25%;
}
.grid-stack > .grid-stack-item[data-gs-width="7"] {
  width: 29.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="7"] {
  left: 29.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="7"] {
  min-width: 29.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="7"] {
  max-width: 29.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="8"] {
  width: 33.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="8"] {
  left: 33.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="8"] {
  min-width: 33.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="8"] {
  max-width: 33.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="9"] {
  width: 37.5%;
}
.grid-stack > .grid-stack-item[data-gs-x="9"] {
  left: 37.5%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="9"] {
  min-width: 37.5%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="9"] {
  max-width: 37.5%;
}
.grid-stack > .grid-stack-item[data-gs-width="10"] {
  width: 41.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="10"] {
  left: 41.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="10"] {
  min-width: 41.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="10"] {
  max-width: 41.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="11"] {
  width: 45.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="11"] {
  left: 45.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="11"] {
  min-width: 45.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="11"] {
  max-width: 45.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="12"] {
  width: 50%;
}
.grid-stack > .grid-stack-item[data-gs-x="12"] {
  left: 50%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="12"] {
  min-width: 50%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="12"] {
  max-width: 50%;
}
.grid-stack > .grid-stack-item[data-gs-width="13"] {
  width: 54.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="13"] {
  left: 54.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="13"] {
  min-width: 54.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="13"] {
  max-width: 54.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="14"] {
  width: 58.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="14"] {
  left: 58.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="14"] {
  min-width: 58.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="14"] {
  max-width: 58.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="15"] {
  width: 62.5%;
}
.grid-stack > .grid-stack-item[data-gs-x="15"] {
  left: 62.5%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="15"] {
  min-width: 62.5%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="15"] {
  max-width: 62.5%;
}
.grid-stack > .grid-stack-item[data-gs-width="16"] {
  width: 66.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="16"] {
  left: 66.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="16"] {
  min-width: 66.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="16"] {
  max-width: 66.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="17"] {
  width: 70.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="17"] {
  left: 70.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="17"] {
  min-width: 70.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="17"] {
  max-width: 70.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="18"] {
  width: 75%;
}
.grid-stack > .grid-stack-item[data-gs-x="18"] {
  left: 75%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="18"] {
  min-width: 75%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="18"] {
  max-width: 75%;
}
.grid-stack > .grid-stack-item[data-gs-width="19"] {
  width: 79.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="19"] {
  left: 79.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="19"] {
  min-width: 79.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="19"] {
  max-width: 79.1666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="20"] {
  width: 83.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="20"] {
  left: 83.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="20"] {
  min-width: 83.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="20"] {
  max-width: 83.3333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="21"] {
  width: 87.5%;
}
.grid-stack > .grid-stack-item[data-gs-x="21"] {
  left: 87.5%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="21"] {
  min-width: 87.5%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="21"] {
  max-width: 87.5%;
}
.grid-stack > .grid-stack-item[data-gs-width="22"] {
  width: 91.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-x="22"] {
  left: 91.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="22"] {
  min-width: 91.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="22"] {
  max-width: 91.6666666667%;
}
.grid-stack > .grid-stack-item[data-gs-width="23"] {
  width: 95.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-x="23"] {
  left: 95.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="23"] {
  min-width: 95.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="23"] {
  max-width: 95.8333333333%;
}
.grid-stack > .grid-stack-item[data-gs-width="24"] {
  width: 100%;
}
.grid-stack > .grid-stack-item[data-gs-x="24"] {
  left: 100%;
}
.grid-stack > .grid-stack-item[data-gs-min-width="24"] {
  min-width: 100%;
}
.grid-stack > .grid-stack-item[data-gs-max-width="24"] {
  max-width: 100%;
}

.font-to-avenir {
      font: AvenirNext;
    }
    .grid-item-img-container {
      height: 80%;
      width: 100%;
      /*align-items: center;
      display: flex;*/
    }







    body{
      font-family: 'AvenirNext';
    }
  </style>

  {% csrf_token %}
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>

  <script type="text/javascript" src="{% static 'WAMSApp/js/jquery.js' %}"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js" type="text/javascript"></script>

  <script type="text/javascript" src="{% static 'WAMSApp/js/jquery.dataTables.min.js' %}"></script>
  <!-- <script type="text/javascript" src="{% static 'WAMSApp/js/materialize-.js' %}"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>



  <script type="text/javascript" src="{% static 'WAMSApp/js/gridstack.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'WAMSApp/js/gridstack.jQueryUI.min.js' %}"></script>

  
  <div class="row" style="margin-bottom: 0em;">
    

    <div class="scroll-style-1 col s3 m4" style="position: fixed;height: 100vh;overflow-y: auto;background-color: #f7f7f7;">
      <div class="row white" style="margin-bottom: 0em;">
        <div class="col s1" style="margin-top: 0.4em;">
          <i class="material-icons" style="position: absolute;margin-top: 0.5em;margin-left: 0.5em;color: #717171;">search</i>
        </div>
        <div class="input-field col s11" style="margin-bottom: 0em;margin-top: 0.4em;">
          <input id="autocomplete-input" placeholder="Search by product name" type="text" class="validate" style="border-bottom: none;box-shadow: none;text-indent: 0.5em;">
        </div>
      </div>
      
      <div class="row">

        <!-- Product Basket -->
        <div class="col s12" style="width: 90%;margin-left: 5%;padding-top: 1em;margin-top: 1em;">
          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.4em;margin-left: -0.5em;">shopping_basket</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Product Basket</span>
          </span>
          
          <div id="product-basket-list-div" class="row hoverable" style="padding:0;">
          </div>
        </div>


        <!-- Image Categories -->
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">
          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.5em;margin-left: -0.5em;">image</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Image Categories</span>
          </span>

          <div class="scroll-style-1 row white hoverable" style="margin-top:0.5em;">
            <div class="input-field col s8">
              <select id="image-categories-thumbnails-select">
                <option value="all_images" id="all-images-option">All Images</option>
                <option value="main_images" id="main-images-option">Main Images</option>
                <option value="sub_images" id="sub-images-option">Sub Images</option>
                <option value="pfl_images" id="pfl-images-option">PFL Images</option>
                <option value="white_background_images" id="white-background-images-option">White Background Images</option>
                <option value="lifestyle_images" id="lifestyle-images-option">Lifestyle Images</option>
                <option value="certificate_images" id="certificate-images-option">Certificate Images</option>
                <option value="giftbox_images" id="giftbox-images-option">Giftbox Images</option>
                <option value="diecut_images" id="diecut-images-option">Diecut Images</option>
                <option value="aplus_content_images" id="aplus-content-images-option">A+ Content Images</option>
                <option value="ads_images" id="ads-images-option">Ads Images</option>
                <option value="unedited_images" id="unedited-images-option">Unedited Images</option>
                <option value="transparent_images" id="transparent-images-option">Transparent Images</option>
              </select>
            </div>

            <div class="col s12">
              <div id="image-categories-thumbnails-div" class="scroll-style-1 row" style="max-height: 10em;overflow-y:auto;">
              </div>
            </div>
          </div>
        </div>

        <!-- External Image Categories -->
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">
          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.5em;margin-left: -0.5em;">image</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">External Image Categories</span>
            <a href="#upload-image-modal" id="import-btn" class="modal-trigger" style="position: absolute;margin-left: 0.5em;margin-top: -0.2em;">
              <i class="material-icons" style="font-size: 1.5em;color:#717171;">add_photo_alternate</i>
            </a>
          </span>
          <!-- <i class="material-icons" style="position: absolute;font-size: 1.5em;margin-left: -0.5em;">image</i> -->

          <div class="scroll-style-1 row white hoverable" style="margin-top:0.5em;">
            <div class="col s12">
              <div id="external-image-categories-thumbnails-div" class="scroll-style-1 row" style="min-height:3em;max-height: 10em;overflow-y:auto;margin-bottom: 0em;">
              </div>
            </div>
          </div>

          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.3em;margin-left: -0.5em;">camera_font</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Image Resizer</span>
          </span>
          <div class="row white hoverable" style="margin-top:0.5em;padding-top:0.6em;padding-bottom: 0.6em;">
            <div class="col s12">
                <p class="range-field" style="width:100%;">
                  <input class="custom-slider" type="range" id="image-resizer" min="10" max="100" value="100" />
                </p>
            </div>
          </div>

        </div>





        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">
          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.5em;margin-left: -0.5em;">short_text</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">PFL Product Name</span>
          </span>
          
          <div class="row white hoverable" style="margin-top: 0.5em;">
            <div class="input-field col s12" style="margin:0em;">
              <input id="product-name-input" type="text" class="validate" style="border-bottom: none;box-shadow: none;">
            </div>
          </div> 
        </div>


        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">
          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.5em;margin-left: -0.5em;">subject</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Feature Summary</span>
          </span>

          <div id="feature-summary-editor-div" class="scroll-style-1 row white hoverable" style="height: 15em;overflow-y:auto;margin-top: 0.5em;">
              <div class="feature-div">
                <div class="input-field col s10">
                  <input style="text-indent: 1em;" placeholder="Type features" type="text" class="feature-text validate">
                </div>
                <div class="input-field col s2">
                  <a id="add-feature-btn" class="btn-floating green" style="margin-top:1em;height: 1.4em;width: 1.4em;"><i class="material-icons" style="font-size: 1em;position: absolute;margin-top: -0.7em;">add</i></a>
                </div>
              </div>
          </div>
        </div>



        <!-- Product Title Settings -->        
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">

          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.3em;margin-left: -0.5em;">font_download</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Product Title Settings</span>
          </span>
          
          <div class="row white hoverable" style="margin-top:0.5em;padding:5px">
            <div class="input-field col s6" style="margin-top: 1em !important;">
              <input id="product-title-font-size" type="number" value="12">
              <label for="product-title-font-size">Font Size</label>  
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="product-title-font-family">
                <option value="Arial">Arial</option> 
                <option value="Impact">Impact</option>
                <option value="Helvetica" selected>Helvetica</option>
                <option value="AvenirNextRegular">AvenirNextRegular</option>
                <option value="BebasNeueRegular">Bebas Neue Regular</option>
                <option value="FrankRegular">Frank Regular</option>
                <option value="GothamBookRegular">Gotham Book Regular</option>
              </select>
              <label>Font Family</label>
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="product-title-font-weight">
                <option value="normal">Normal</option> 
                <option value="bold">Bold</option>
              </select>
              <label>Font Weight</label>
            </div>  

            <div class="input-field col s6" style="margin-top: 2em !important;">
              <span>Font Color</span>
              <input id="product-title-font-color" type="color" value="#181818"> 
            </div>

          </div>
        </div>







        <!-- Seller SKU Settings -->        
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">

          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.3em;margin-left: -0.5em;">font_download</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Seller SKU Settings</span>
          </span>
          
          <div class="row white hoverable" style="margin-top:0.5em;padding:5px">
            <div class="input-field col s6" style="margin-top: 1em !important;">
              <input id="seller-sku-font-size" type="number" value="12">
              <label for="seller-sku-font-size">Font Size</label>  
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="seller-sku-font-family">
                <option value="Arial">Arial</option> 
                <option value="Impact">Impact</option>
                <option value="Helvetica" selected>Helvetica</option>
                <option value="AvenirNextRegular">AvenirNextRegular</option>
                <option value="BebasNeueRegular">Bebas Neue Regular</option>
                <option value="FrankRegular">Frank Regular</option>
                <option value="GothamBookRegular">Gotham Book Regular</option>
              </select>
              <label>Font Family</label>
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="seller-sku-font-weight">
                <option value="normal">Normal</option> 
                <option value="bold">Bold</option>
              </select>
              <label>Font Weight</label>
            </div>  

            <div class="input-field col s6" style="margin-top: 2em !important;">
              <span>Font Color</span>
              <input id="seller-sku-font-color" type="color" value="#181818"> 
            </div>

          </div>
        </div>






        <!-- Feature Settings -->        
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">

          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.3em;margin-left: -0.5em;">font_download</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Feature Settings</span>
          </span>
          
          <div class="row white hoverable" style="margin-top:0.5em;padding:5px">
            <div class="input-field col s6" style="margin-top: 1em !important;">
              <input id="feature-font-size" type="number" value="12">
              <label for="feature-font-size">Font Size</label>  
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="feature-font-family">
                <option value="Arial">Arial</option> 
                <option value="Impact">Impact</option>
                <option value="Helvetica" selected>Helvetica</option>
                <option value="AvenirNextRegular">AvenirNextRegular</option>
                <option value="BebasNeueRegular">Bebas Neue Regular</option>
                <option value="FrankRegular">Frank Regular</option>
                <option value="GothamBookRegular">Gotham Book Regular</option>
              </select>
              <label>Font Family</label>
            </div>

            <div class="input-field col s6" style="margin-bottom: 1em;">
              <select id="feature-font-weight">
                <option value="normal">Normal</option> 
                <option value="bold">Bold</option>
              </select>
              <label>Font Weight</label>
            </div>  

            <div class="input-field col s6" style="margin-top: 2em !important;">
              <span>Font Color</span>
              <input id="feature-font-color" type="color" value="#181818"> 
            </div>

          </div>
        </div>


        <!-- Header Footer Settings -->        
        <div class="col s12" style="width: 90%;margin-left: 5%;margin-top: 1em;">

          <span style="font-family: 'AvenirNextRegular';color:#717171;">
            <i class="material-icons" style="position: absolute;font-size: 1.3em;margin-left: -0.5em;">view_day</i>
            <span style="margin-left: 1.5em;font-size: 14px;font-weight: bold;">Header/Footer Settings</span>
          </span>
          
          <div class="row white hoverable" style="margin-top:0.5em;padding:5px;">
            <div class="input-field col s6" style="margin-top: 0em !important;">
              <p style="font-family: 'AvenirNext'; font-size: 14px;margin-bottom: 0em;">Header Color</p>
              <input id="header-color" type="color" value="#181818">  
            </div>

            <div class="input-field col s6" style="margin-top: 0em !important;">
              <p style="font-family: 'AvenirNext'; font-size: 14px;margin-bottom: 0em;">Footer Color</p>
              <input id="footer-color" type="color" value="#181818">
            </div>

          </div>
        </div>



        <div class="col s12" style="width: 90%;margin-left: 5%;padding-right: 0em;">
          <a id="save-pfl-template-btn" class="btn right" style="background-color: #521893;font-size: 14px; font-family: 'AvenirNext';">Save</a>
        </div>
        
      </div>

    </div>



    <div class="col s9 offset-s3 m8 offset-m4" style="background-color: #393939;">
      <div>
        <div class="row" style="margin-left: auto;margin-right: auto;">
          <div class="col s12 center" style="padding-left: 0em;padding-right: 0em;">
            <br>
            <a class="btn" style="background-color: #717171;width:10em;text-align: left;text-transform: none;">PFL</a>
            <a id="download-pfl-btn" class="btn green" style="background-color: #717171;width:10em;text-align: left;text-transform: none;margin-left: 136mm;position: relative;">Download<i class="material-icons right">file_download</i>
              <div id="loader-div" class="preloader-wrapper small active" style = "display:none;position: absolute;left: -50px; top: 0px;">
                <div class="spinner-layer spinner-green-only">
                  <div class="circle-clipper left">
                    <div class="circle"></div>
                  </div><div class="gap-patch">
                    <div class="circle"></div>
                  </div><div class="circle-clipper right">
                    <div class="circle"></div>
                  </div>
                </div>
               </div>
            </a>
          </div>
        </div>
        <div id="pfl-div" class="row white" style="text-align: center;margin-left: auto;margin-right: auto;height: 297mm;width: 210mm;">

          <!-- Brand Image Preview -->
          <div id="brand-image" class="col s6 right">
            <br>
            <img id="brand-image-img" src="" style="width: 73.5mm;margin-left:-27mm;display: none;position: absolute;">
          </div>
          
          <!-- Product Image Preview -->
          <div class="col s12" style="text-align: center; position: absolute;width: 210mm;margin-top: 40mm;">
            <div id="grid-stack-div" class="grid-stack" data-gs-width="24" data-gs-animate="yes" data-gs-column="24" style="max-height: 260mm;">
              <div grid-id="1" class="grid-stack-item" data-gs-width=24 data-gs-height=10 data-gs-x=0 data-gs-y=0 data-gs-max-height=15 style="text-align:center;padding:0em !important;">
                <div class="grid-stack-item-content hoverable">
                  <div class="grid-item-img-container" style="display:flex;justify-content:center;align-items:center;">
                    <img id="pfl-product-image-preview-img" style="max-width: 100%;display: none;background-size: 100% 100%;">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Product Name Preview -->
          <div id="header-div" class="col s12" style="background-color:#521893;text-align: center;width: 210mm;padding-bottom: 1em;position: absolute;margin-top: 190mm;width:210mm;height: 20mm;">
            <div id="product-name-preview" class="left" style="padding-left: 1em;text-transform: uppercase;margin-top: 6.4mm;font-size: 1.5em;font-family:'AvenirNextRegular';">
            </div>
          </div>

          <!-- Seller SKU Preview -->
          <div class="col s12" style="background-color:white;position: absolute;margin-top: 192.5mm;width:45mm;height: 15mm;margin-left: 156mm;text-align: center;">
            <span id="seller-sku-preview" style="font-size: 1.2em;font-family:'AvenirNextRegular'; line-height: 16mm;color:#521893;"></span>
          </div>

  
          <!-- Features Preview -->
          <div class="col s12" style="position: absolute;margin-top: 218mm;width: 10mm;">
            <span id="features-heading" style="color:#521893;font-size: 1.4em;font-family: 'AvenirNext';padding-left: 1em;">Features</span>
          </div>
          <div class="col s12" style="margin-top: 215mm;">
            <div id="features-preview-div" style="padding-left: 1.3em;text-align:left;">
            </div>
          </div>


          <!-- Barcode Preview -->
          <div class="col s3" style="position: absolute;margin-top: 240mm;width:45mm;margin-left:152mm;">
            <br><br>
            <img id="barcode-image-preview-img" src="" style="display:none;width: 100%;">
          </div>
          
          <!-- Footer -->
          <div id="footer-div" class="col s12" style="background-color:#521893;position: absolute;margin-top: 287mm;width:210mm;height: 10mm;">
            <div class="white-text" style="font-size: 1.1em;margin-top:-1mm;">
              <p contenteditable class="right" style="color:#009051;font-size: 0.8em;color:white;font-family:'AvenirNextRegular';">For more information, please visit www.royalford.com</p>
            </div>
          </div>

        </div>
      </div>
    </div>

<div id="upload-image-modal" class="modal">
  <div class="modal-content">
    <h4 style="font-family:'AvenirNext';font-size:18px;">Upload Image</h4>
    <div class="file-field input-field">
      <div class="btn" style = "background-color: #512da8">
        <span style="font-size:14px;">File</span>
        <input id="product-image-input" type="file" multiple>
      </div>
      <div class="file-path-wrapper">
        <input class="file-path validate" type="text">
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
    <a id="upload-image-btn" href="#!" class="waves-effect waves-green btn-flat blue white-text" style="background-color:#009051 !important ;">Upload</a>
    <div class="progress" id = "upload-preloader" style = "display:none;margin: 0px !important;background-color: white !important;">
      <div class="indeterminate" style = "background-color: #512de8;"></div>
    </div>
  </div>
</div>


    <div id="upload-product-pfl-image-modal" class="modal">
      <div class="modal-content">
        <h5 style="font-family: 'AvenirNext';font-size: 18px">UPLOAD EXTERNAL IMAGE</h5>
        <br>
        <div class="row">
          <div class="file-field input-field">
            <div class="btn">
              <span>Image</span>
              <input id="external-image-input" type="file">
            </div>
            <div class="file-path-wrapper">
              <input class="file-path validate" type="text">
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect btn-flat">Cancel</a>
        <a id="upload-external-image-btn" href="#!" class="waves-effect btn-flat blue white-text">Upload</a>
      </div>
    </div>

  </div>

  <script type="text/javascript" src="{% static 'WAMSApp/js/canvas2image.js' %}"></script>
  <script type="text/javascript" src="{% static 'WAMSApp/js/html2canvas.min2.js' %}"></script>
  <!-- <script type="text/javascript" src="{% static 'WAMSApp/js/html2canvas.js' %}"></script> -->
  <!-- <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> -->
  <script type="text/javascript">
    $('.sidenav').sidenav({
      "inDuration": 150,
      "outDuration": 150
    });

    $("select").formSelect();
    $('.modal').modal();



    $('.grid-stack').gridstack({
        animate: true,
        removable: true,
        verticalMargin: 6,
        column: 24,
        cellHeight: 30,
        resizable: {
          handles: 'e, se, s, sw, w'
        }
    });

    var elems  = document.querySelectorAll("input[type=range]");  
    M.Range.init(elems);


    $("#image-resizer").change(function() {
      var R = $("#image-resizer").val();

      $("#pfl-product-image-preview-img").css("width", R+"%");
      $("#pfl-product-image-preview-img").attr("resizer", R);
    });


    function dataURLtoBlob(dataurl) {
      var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
          bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
      while(n--){
          u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], {type:mime});
    }
    
    $("#download-pfl-btn").click(function(e){

      $("#download-pfl-btn").attr("disabled", "disabled");
      $("#loader-div").show();

      var image_links = [];

      if($("#pfl-product-image-preview-img").attr("src")!="")
      {
        image_links.push({
          "key": "product_image",
          "url": $("#pfl-product-image-preview-img").attr("src")
        });
      }

      if($("#brand-image-img").attr("src")!="")
      {
        image_links.push({
          "key": "brand_image",
          "url": $("#brand-image-img").attr("src")
        });
      }

      if($("#barcode-image-preview-img").attr("src")!="")
      {
        image_links.push({
          "key": "barcode_image",
          "url": $("#barcode-image-preview-img").attr("src")
        });
      }

      $.ajax({
        url: "/download-images-s3/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: { 
          links : JSON.stringify(image_links)
        },
        success: function(response) {
            console.log("Success! ", response);
            if(response["status"]==200)
            {
              //[{"key": "grind-1", "url": "aws/im1.png"}, {}]
              var local_links = response["local_links"];

              for(var i=0;i<response["local_links"].length;i++){
                if (local_links[i]["key"] == "product_image"){
                  $("#pfl-product-image-preview-img").attr("src", local_links[i]["url"]);
                }
                else if(local_links[i]["key"] == "brand_image"){
                  $("#brand-image-img").attr("src", local_links[i]["url"]);
                }
                else if(local_links[i]["key"] == "barcode_image"){
                  $("#barcode-image-preview-img").attr("src", local_links[i]["url"]);
                }
              }

              if($("#border-option").prop("checked"))
              {
                $(".divgrid").css("border", "2px solid #E9E9E9");
                $(".divgrid").css("border-bottom", "none");
              }
              else
              {
                $(".divgrid").css("border", "none");
              }


              var scale = 5;
              var div = document.getElementById('pfl-div');
              var canvas = document.createElement('canvas');
              var h = div.scrollHeight;
              var ratio = canvas.width/canvas.height;
              var w = h * ratio;
              canvas.width = scale*window.devicePixelRatio*div.scrollWidth;
              canvas.height = scale*window.devicePixelRatio*div.scrollHeight;
              canvas.style.width = w + 'px';
              canvas.style.height = h + 'px';
              var context = canvas.getContext('2d');
              context.scale(scale, scale);
              
              window.scrollTo(0,0);
              html2canvas(div, {canvas:canvas, scrollX:-10, scrollY:0}).then(function(canvas) {

                    $("#download-pfl-btn").removeAttr("disabled");
                    $("#loader-div").hide();

                    var dataURI = canvas.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream");

                    var blob = dataURLtoBlob(dataURI);
                    var objurl = URL.createObjectURL(blob);
                    
                    var a = document.createElement('a');
                    a.download = 'pfl_image_'+(window.location.pathname.split("/")[2])+'.jpg';
                    a.href = objurl;
                    a.click();

                    var image_data = dataURI;

                    var fd = new FormData();
                    fd.append('image_data', image_data);
                    fd.append('pfl_pk', window.location.pathname.split("/")[2]);

                    $.ajax({
                      url: "/save-pfl-in-bucket/",
                      type: "POST",
                      headers:{
                        'X-CSRFToken':getCsrfToken()
                      },
                      processData: false,
                      contentType: false,
                      data: fd,
                      success: function(response) {
                        console.log("Success!", response);
                      },
                      error: function(xhr, textstatus, errorthrown) {
                        console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
                      }
                    });

                });
            }
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
          $("#loader-div").hide();
        }
      });

    });

    var global_pfl_product_pk = null;
    var global_product_images_dict = {};
    var global_pfl_image_pk = null;
    var global_pfl_image_url = null;
    var global_product_name = "";
    var global_product_name_sap = "";
    var global_external_image_bucket = [];


    var global_product_font_size = "25";
    var global_product_font_family = "Helvetica";
    var global_product_font_weight = "normal";
    var global_product_font_color = "#181818";
    var global_seller_sku_font_size = "12";
    var global_seller_sku_font_family = "Helvetica";
    var global_seller_sku_font_weight = "normal";
    var global_seller_sku_font_color = "#181818";
    var global_feature_font_size = "12";
    var global_feature_font_family = "Helvetica";
    var global_feature_font_weight = "normal";
    var global_feature_font_color = "#181818";
    var global_header_color = "#573B93";
    var global_footer_color = "#573B93";



    function render_fetures()
    {
      var html_string = `<br><br>`;
      var feature_text = $(".feature-text");
      for(var i=0;i<feature_text.length;i++)
      {
        html_string += `<span class="feature-text-preview" style="font-family: 'AvenirNextRegular'"><span style="color:#521893;">&bullet;&nbsp;&nbsp;</span> `+feature_text[i].value+`</span><br>`

      }
      $("#features-preview-div").html(html_string);
      set_editor_style();
    }


    $("#add-feature-btn").click(function(){
      var html_string = `<div class="feature-div">
                <div class="input-field col s10">
                  <input style="text-indent: 1em;" placeholder="Type features" type="text" class="feature-text validate">
                </div>
                <div class="input-field col s2">
                  <a class="delete-feature-btn btn-floating red" style="margin-top:1em;height: 1.4em;width: 1.4em;"><i class="material-icons" style="font-size: 1em;position: absolute;margin-top: -0.7em;">remove</i></a>
                </div>
              </div>`;
        $("#feature-summary-editor-div").append(html_string);
    });

    $(document).on('click', ".delete-feature-btn", function(){
      $(this).parent().parent().remove();
      render_fetures();
    });


    $(document).on('keyup', '.feature-text', function(){
      render_fetures();
    })

    $("#product-name-input").keyup(function(){
      $("#product-name-preview").html($("#product-name-input").val().substring(0,38));
    });


    $("#upload-external-image-btn").click(function(){

        var fd = new FormData();

        var image_file = document.getElementById("external-image-input");
        fd.append('image', image_file.files[0]);
        fd.append('pfl_pk', window.location.pathname.split("/")[2]);

        $("#upload-external-image-btn").attr("disabled", "disabled");

        $.ajax({
          url: "/upload-image-external-bucket-pfl/",
          type: "POST",
          headers:{
            'X-CSRFToken':getCsrfToken()
          },
          processData: false,
          contentType: false,
          data: fd,
          success: function(response) {
            console.log("Success!", response);
            if(response["status"]==200)
            {
              var image_pk = response["image_pk"];
              var image_url = response["image_url"];

              $("#upload-external-image-btn").removeAttr("disabled");
              $("#upload-product-pfl-image-modal").modal("close");
              global_product_images_dict["external_images"].push({"pk": image_pk,"url": image_url});
              global_pfl_image_url = image_url
              set_pfl_image();
              $("#image-categories-thumbnails-select").val("external_images");
              $("select").formSelect();
              update_image_categories("external_images");
            }
          },
          error: function(xhr, textstatus, errorthrown) {
            console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
          }
        });

    });
    



    function getCsrfToken() {
      var CSRF_TOKEN = $('input[name="csrfmiddlewaretoken"]').val();
      return CSRF_TOKEN;
    }


    function add_to_product_basket()
    {
      var product_name = $("#autocomplete-input").val();


      $.ajax({
        url: "/add-product-pfl-bucket/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: {
          product_name: product_name,
          pfl_pk: window.location.pathname.split("/")[2]
        },
        success: function(response) {
          console.log("Success!", response);
          if(response["status"]==200)
          {
            //Product Basket needs to be updated
            // var html_string = "";

            // var image_url = response["image_url"];
            // var product_name = response["product_name"];
            // var product_pk = response["product_pk"];
            // var seller_sku = response["seller_sku"];
            // global_pfl_product_pk = product_pk;

            // set_product_basket(image_url, product_name, seller_sku);

            fetch_pfl_details();
          }
          else if(response["status"]==403)
          {
            M.toast({html: "You do not have permission to add products to PFL bucket!"});
          }
          else
          {
            M.toast({html: "Error adding product to PFL bucket!"}); 
          }
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
        }
      });


      $("#autocomplete-input").val("");

    }

    function fetch_product_list_autocomplete()
    {
      $.ajax({
        url: "/fetch-product-list-flyer-pfl/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: {},
        success: function(response) {
          console.log("Success!", response);

          var autocomplete_data = {};
          var product_list = response["product_list"];
          for(var i=0;i<product_list.length;i++)
          {
            autocomplete_data[product_list[i]["product_name_autocomplete"]] = product_list[i]["main_image_url"]; 
          }

          $('#autocomplete-input').autocomplete({
            data: autocomplete_data,
            onAutocomplete: function()
            {
              add_to_product_basket();
            }
          });
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
        }
      });
    }

    fetch_product_list_autocomplete();


    function set_brand_image(url)
    {
      if(url!=null && url!="")
      {
        $("#select-brand-image-div").hide();
        $("#brand-image-img").attr("src", url);
        $("#brand-image-img").show();
      }
    }


    function set_product_id(product_id)
    {
      if(product_id!="" && product_id!=null)
      {

        $("#product-id-preview").hide();
        $("#product-id-preview-data").html("ID: "+product_id);
        $("#product-id-preview-data").show();
        $("#product-id-main-div").css("background-color", "#E8F6FF");
      }
    }


    function set_barcode_image(url)
    {
      if(url!=null)
      {
        $("#barcode-image-preview-btn").hide();
        $("#barcode-image-preview-img").attr("src", url);
        $("#barcode-image-preview-img").show();
      }
    }

    function set_feature_list(features)
    {
      if(features.length>0)
        $(".feature-text")[0].value = features[0];
      for(var i=1;i<features.length;i++)
      {
        $("#add-feature-btn").click();
        $(".feature-text")[i].value = features[i];
      }
      M.updateTextFields();
      render_fetures();
    }


    function set_product_basket(image_url, product_name, seller_sku)
    {
      //Product Basket needs to be updated
      var html_string = "";
      var short_product_name = product_name
      var char_length = 50;
      if(product_name.length>char_length)
      {
        short_product_name = short_product_name.substring(0, char_length) + "...";
      }

      html_string += `
      <div class="col s12 m12">
          <div class="row white" style="border: 2px solid #E9E9E9;margin-bottom:0em;">
            <div class="col s4" style="padding-left:0em;margin-right:0em;padding-right:0em;">
              <div class="img-box" style="border-right: 2px solid #E9E9E9;text-align:center;padding-top:0.5em;">
                <img src="`+image_url+`" style="width:80%;max-height:5em;margin-left:0;object-fit: cover;object-position:center;">
              </div>
            </div>
            <div class="product-basket-card col s8">
              <div style="padding-left:0em;height:6em;">
                <div style="padding-top:1em;font-family:'AvenirNext';color:#521893;" title="`+product_name+`">`+
                  short_product_name+`
                </div>
                <div style="padding-top:1em;font-family:'AvenirNextRegular';color:black;margin-top:-1em;font-size:0.8em;">`+
                seller_sku+`
                </div>
              </div>
            </div>
          </div>
          </div>`;

      $("#product-basket-list-div").html(html_string);
    }



    function update_image_categories(key)
    {
      var html_string = "";

      var images = global_product_images_dict[key];
      for(var i=0;i<images.length;i++)
      {
        html_string += `<div class="col s3" style="padding-top:0.2em;">
          <div style="border:1px solid #E9E9E9;">
            <a class="imgselect" id="imgselect_`+images[i]["pk"]+`" href="#!"><img src="`+images[i]["url"]+`" style="width:90%;height:3em;object-fit:cover;" high-res-url="`+images[i]["high-res-url"]+`"></a>
          </div>
        </div>`;
      }

      $("#image-categories-thumbnails-div").html(html_string);
    }



    function set_pfl_image()
    {
      if(global_pfl_image_url!=null)
      {
        $("#pfl-product-image-preview-btn").hide();
        $("#pfl-product-image-preview-img").attr("src", global_pfl_image_url);
        $("#pfl-product-image-preview-img").show();
      }
    }


    function update_external_image_bucket()
    {
      var html_string = "";

      var images = global_external_image_bucket;
      for(var i=0;i<images.length;i++)
      {
        html_string += `<div class="col s3" style="padding-top:0.2em;margin-bottom:1.4em;">
          <div style="border:2px solid #E9E9E9;text-align:center;padding-top:0.4em;">
            <a class="imgselect" href="#!">
              <img src="`+images[i]["url"]+`" high-res-url="`+images[i]["high-res-url"]+`" style="width:90%;height:3em;object-fit:cover;">
            </a>
          </div>
        </div>`;
      }

      $("#external-image-categories-thumbnails-div").html(html_string); 
    }

    function set_product_name()
    {
      $("#product-name-preview").html(global_product_name.substring(0, 38));
      $("#product-name-input").val(global_product_name);
      M.updateTextFields();
    }


    $(document).on('click', '.imgselect', function(){
        global_pfl_image_pk = this.id.split("_")[1];
        global_pfl_image_url = $($(this).children()[0]).attr("high-res-url");
        set_pfl_image();
    });


    $("#image-categories-thumbnails-select").on("change", function(){
      update_image_categories($("#image-categories-thumbnails-select").val());
    });


    $("#pfl-product-image-preview-btn").click(function(){
      
    });


    function set_seller_sku(seller_sku)
    {
      $("#seller-sku-preview").html(seller_sku);
    }


    function fetch_product_details_flyer_pfl()
    {
      $.ajax({
        url: "/fetch-product-details-flyer-pfl/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: {
          product_pk: global_pfl_product_pk,
          pfl_pk: window.location.pathname.split("/")[2]
        },
        success: function(response) {
          console.log("Success!", response);
          if(response["status"]==200)
          {
            global_product_images_dict = response["images"];

            $("#all-images-option").html("All Images ("+global_product_images_dict["all_images"].length+")");
            $("#main-images-option").html("Main Images ("+global_product_images_dict["main_images"].length+")");
            $("#sub-images-option").html("Sub Images ("+global_product_images_dict["sub_images"].length+")");
            $("#pfl-images-option").html("PFL Images ("+global_product_images_dict["pfl_images"].length+")");
            $("#white-background-images-option").html("White Background Images ("+global_product_images_dict["white_background_images"].length+")");
            $("#lifestyle-images-option").html("Lifestyle Images ("+global_product_images_dict["lifestyle_images"].length+")");
            $("#certificate-images-option").html("Certificate Images ("+global_product_images_dict["certificate_images"].length+")");
            $("#giftbox-images-option").html("Giftbox Images ("+global_product_images_dict["giftbox_images"].length+")");
            $("#diecut-images-option").html("Diecut Images ("+global_product_images_dict["diecut_images"].length+")");
            $("#aplus-content-images-option").html("A+ Content Images ("+global_product_images_dict["aplus_content_images"].length+")");
            $("#ads-images-option").html("Ads Images ("+global_product_images_dict["ads_images"].length+")");
            $("#unedited-images-option").html("Unedited Images ("+global_product_images_dict["unedited_images"].length+")");
            $("#transparent-images-option").html("Transparent Images ("+global_product_images_dict["transparent_images"].length+")");
            $("select").formSelect();

            update_image_categories("all_images");
          }
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
        }
      });
    }


    function set_container(template_data)
    {
      var width = template_data["container"]["width"];
      var height = template_data["container"]["height"];
      var x = template_data["container"]["x"];
      var y = template_data["container"]["y"];

      $(".grid-stack-item").attr("data-gs-width", width);
      $(".grid-stack-item").attr("data-gs-height", height);
      $(".grid-stack-item").attr("data-gs-x", x);
      $(".grid-stack-item").attr("data-gs-y", y);

      var resizer = template_data["common"]["image-resizer"];
      $("#image-resizer").val(resizer);
      $("#image-resizer").change();
    }


    function fetch_pfl_details()
    {
      $.ajax({
        url: "/fetch-pfl-details/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: {
          pk: window.location.pathname.split("/")[2]
        },
        success: function(response) {
          console.log("Success!", response);

          global_pfl_product_pk = response["product_pk"]

          if(global_pfl_product_pk!=null)
          {
            $("#autocomplete-input").attr("disabled", "disabled");
            set_product_basket(response["product_main_image_url"], response["product_name_sap"], response["seller_sku"]);
          }

          set_brand_image(response["logo_image_url"]);
          set_product_id(response["product_id"]);
          set_barcode_image(response["barcode_image_url"]);
          set_feature_list(response["pfl_product_features"]);
          set_seller_sku(response["seller_sku"])

          global_product_name = response["product_name"];
          global_product_name_sap = response["product_name_sap"];
          set_product_name();

          global_external_image_bucket = response["external_images_bucket_list"]
          update_external_image_bucket();

          global_pfl_image_pk = response["product_image"]["image_pk"];
          global_pfl_image_url = response["product_image"]["image_url"];
          set_pfl_image();
          if(global_pfl_product_pk!=null && global_pfl_product_pk!="")
          {
            fetch_product_details_flyer_pfl();
          }

          set_container(response["template_data"]);


          var template_data = response["template_data"]["common"]

          global_product_font_size = template_data["product-title-font-size"]
          global_product_font_family = template_data["product-title-font-family"]
          global_product_font_weight = template_data["product-title-font-weight"]
          global_product_font_color = template_data["product-title-font-color"]

          global_seller_sku_font_size = template_data["seller-sku-font-size"]
          global_seller_sku_font_family = template_data["seller-sku-font-family"]
          global_seller_sku_font_weight = template_data["seller-sku-font-weight"]
          global_seller_sku_font_color = template_data["seller-sku-font-color"]

          global_feature_font_size = template_data["feature-font-size"]
          global_feature_font_family = template_data["feature-font-family"]
          global_feature_font_weight = template_data["feature-font-weight"]
          global_feature_font_color = template_data["feature-font-color"]

          global_header_color = template_data["header-color"]
          global_footer_color = template_data["footer-color"]

          update_editor();
          set_editor_style();

        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
        }
      });
    }

    fetch_pfl_details();


    $("#save-pfl-template-btn").click(function(){
      
      $("#save-pfl-template-btn").attr("disabled", "disabled");

      var product_features = [];
      var feature_text = $(".feature-text");
      for(var i=0;i<feature_text.length;i++)
      {
        product_features.push(feature_text[i].value);
      }
      product_features = JSON.stringify(product_features);


      var product_name = $("#product-name-input").val();

      var width = $($(".grid-stack-item")[0]).attr("data-gs-width");
      var height = $($(".grid-stack-item")[0]).attr("data-gs-height");
      var x = $($(".grid-stack-item")[0]).attr("data-gs-x");
      var y = $($(".grid-stack-item")[0]).attr("data-gs-y");
      
      var image_resizer = $("#image-resizer").val();

      var template_data = {
        "container": {
          "width": width,
          "height": height,
          "x": x,
          "y": y
        },
        "common": {
          "image-resizer": image_resizer,
          "product-title-font-size": global_product_font_size,
          "product-title-font-family": global_product_font_family,
          "product-title-font-weight": global_product_font_weight,
          "product-title-font-color": global_product_font_color,
          "seller-sku-font-size": global_seller_sku_font_size,
          "seller-sku-font-family": global_seller_sku_font_family,
          "seller-sku-font-weight": global_seller_sku_font_weight,
          "seller-sku-font-color": global_seller_sku_font_color,
          "feature-font-size": global_feature_font_size,
          "feature-font-family": global_feature_font_family,
          "feature-font-weight": global_feature_font_weight,
          "feature-font-color": global_feature_font_color,
          "header-color": global_header_color,
          "footer-color": global_footer_color
        }
      }

      $.ajax({
        url: "/save-pfl-template/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        data: {
          pfl_pk: window.location.pathname.split("/")[2],
          image_pk: global_pfl_image_pk,
          product_name: product_name,
          product_features: product_features,
          template_data:JSON.stringify(template_data)
        },
        success: function(response) {
          console.log("Success!", response);
          $("#save-pfl-template-btn").removeAttr("disabled");
          if(response["status"]==200)
          {
            M.toast({html: "PFL template saved successfully!"});
          }
          else if(response["status"]==403)
          {
            M.toast({html: "You do not have permission to save PFL!"}); 
          }
          else
          {
            M.toast({html: "Error saving PFL!"}); 
          }
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
        }
      });

    });




    $("#upload-image-btn").click(function(){

      var fd = new FormData();
      fd.append("pfl_pk", window.location.pathname.split("/")[2]);

      var product_image_input = document.getElementById("product-image-input");

      fd.append("image_count", product_image_input.files.length);
      for(var i=0;i<product_image_input.files.length;i++)
      {
        fd.append("image_"+i, product_image_input.files[i]);
      }
      $("#upload-preloader").show();
      $("#upload-image-btn").attr("disabled", "disabled");

      $.ajax({
        url: "/upload-pfl-external-images/",
        type: "POST",
        headers:{
          'X-CSRFToken':getCsrfToken()
        },
        processData: false,
        contentType: false,
        data: fd,
        success: function(response) {
          console.log("Success!", response);
          $("#upload-preloader").hide();
          $("#upload-image-btn").removeAttr("disabled");

          if(response["status"]==200)
          {
            $("#upload-image-modal").modal("close");
            M.toast({html: "Successfully uploaded images!"});

            var images = response["external_images_bucket_list"];
            for(var i=0;i<images.length;i++)
            {
              global_external_image_bucket.push({"url":images[i]["url"], "high-res-url":images[i]["high-res-url"]});
            }
            update_external_image_bucket();
          }
          else if(response["status"]==403)
          {
            M.toast({html: "You do not have permission to upload images!"});
          }
          else
          {
            M.toast({html: "Error uploading images!"});
          }
        },
        error: function(xhr, textstatus, errorthrown) {
          console.log("Please report this error: "+errorthrown+xhr.status+xhr.responseText);
          $("#upload-preloader").hide();
        }
      });
    });


    $("#product-title-font-size").change(function(){
      global_product_font_size = this.value;
      set_editor_style();
    });

    $("#product-title-font-family").change(function(){
      global_product_font_family = this.value;
      set_editor_style();
    });

    $("#product-title-font-weight").change(function(){
      global_product_font_weight = this.value;
      set_editor_style();
    });

    $("#product-title-font-color").change(function(){
      global_product_font_color = this.value;
      set_editor_style();
    });

    $("#seller-sku-font-size").change(function(){
      global_seller_sku_font_size = this.value;
      set_editor_style();
    });

    $("#seller-sku-font-family").change(function(){
      global_seller_sku_font_family = this.value;
      set_editor_style();
    });

    $("#seller-sku-font-weight").change(function(){
      global_seller_sku_font_weight = this.value;
      set_editor_style();
    });

    $("#seller-sku-font-color").change(function(){
      global_seller_sku_font_color = this.value;
      set_editor_style();
    });

    $("#feature-font-size").change(function(){
      global_feature_font_size = this.value;
      set_editor_style();
    });

    $("#feature-font-family").change(function(){
      global_feature_font_family = this.value;
      set_editor_style();
    });

    $("#feature-font-weight").change(function(){
      global_feature_font_weight = this.value;
      set_editor_style();
    });

    $("#feature-font-color").change(function(){
      global_feature_font_color = this.value;
      set_editor_style();
    });

    $("#header-color").change(function(){
      global_header_color = this.value;
      set_editor_style();
    });

    $("#footer-color").change(function(){
      global_footer_color = this.value;
      set_editor_style();
    });



    function update_editor()
    {
      $("#product-title-font-size").val(global_product_font_size);
      $("#product-title-font-family").val(global_product_font_family);
      $("#product-title-font-weight").val(global_product_font_weight);
      $("#product-title-font-color").val(global_product_font_color);

      $("#seller-sku-font-size").val(global_seller_sku_font_size);
      $("#seller-sku-font-family").val(global_seller_sku_font_family);
      $("#seller-sku-font-weight").val(global_seller_sku_font_weight);
      $("#seller-sku-font-color").val(global_seller_sku_font_color);

      $("#feature-font-size").val(global_feature_font_size);
      $("#feature-font-family").val(global_feature_font_family);
      $("#feature-font-weight").val(global_feature_font_weight);
      $("#feature-font-color").val(global_feature_font_color);

      $("#header-color").val(global_header_color)
      $("#footer-color").val(global_footer_color)
    }


    function set_editor_style()
    {
      $("#product-name-preview").css("font-size", global_product_font_size+"px");
      $("#product-name-preview").css("font-family", global_product_font_family);
      $("#product-name-preview").css("font-weight", global_product_font_weight);
      $("#product-name-preview").css("color", global_product_font_color);

      $("#seller-sku-preview").css("font-size", global_seller_sku_font_size+"px");
      $("#seller-sku-preview").css("font-family", global_seller_sku_font_family);
      $("#seller-sku-preview").css("font-weight", global_seller_sku_font_weight);
      $("#seller-sku-preview").css("color", global_seller_sku_font_color);

      $(".feature-text-preview").css("font-size", global_feature_font_size+"px");
      $(".feature-text-preview").css("font-family", global_feature_font_family);
      $(".feature-text-preview").css("font-weight", global_feature_font_weight);
      $(".feature-text-preview").css("color", global_feature_font_color);

      $("#features-heading").css("color", global_feature_font_color);

      $("#header-div").css("background-color", global_header_color);
      $("#footer-div").css("background-color", global_footer_color);
    }


  </script>

</body>
</html>
